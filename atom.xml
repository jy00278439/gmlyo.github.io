<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>G加菲</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.gmlyo.com/"/>
  <updated>2018-09-05T19:38:02.297Z</updated>
  <id>http://www.gmlyo.com/</id>
  
  <author>
    <name>G加菲</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SaltStack 数据系统 Pillar</title>
    <link href="http://www.gmlyo.com/2018/09/06/SaltStack-%E6%95%B0%E6%8D%AE%E7%B3%BB%E7%BB%9F-Pillar/"/>
    <id>http://www.gmlyo.com/2018/09/06/SaltStack-数据系统-Pillar/</id>
    <published>2018-09-05T17:58:05.000Z</published>
    <updated>2018-09-05T19:38:02.297Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SaltStack-数据系统-Pillar"><a href="#SaltStack-数据系统-Pillar" class="headerlink" title="SaltStack 数据系统 Pillar"></a>SaltStack 数据系统 Pillar</h1><a id="more"></a><table><thead><tr><th>名称</th><th>存储位置</th><th>数据类型</th><th>数据采集更新方式</th><th>应用</th></tr></thead><tbody><tr><td>Grains</td><td>Minion端</td><td>静态数据</td><td>Minion启动时收集，也可以使用 saltutil.sync_grains 进行刷新</td><td>存储 Minion 基本数据，比如用于匹配 Minion，自身数据可以用来作资产管理等。</td></tr><tr><td>Pillar</td><td>Master端</td><td>动态数据</td><td>在Master端定义，指定给对应的Minion。可以使用 saltutil.refresh_pillar 刷新</td><td>存储 Master 指定的数据，只有指定的 Minion 可以看到。用于敏感数据保存。</td></tr></tbody></table><p>Pillar 是在 Master端 设置的<br>Pillar 给 Minion端 指定它想要的数据<br>安全性比较高</p><blockquote><p>查看 <code>Pillar</code> 信息<br>默认是 <code>False</code> 状态<br><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# salt <span class="string">'*'</span> pillar.items</span><br><span class="line"><span class="name">dbfw01</span>:</span><br><span class="line">    <span class="comment">----------</span></span><br><span class="line">fat-<span class="name">ydm01</span>:</span><br><span class="line">    <span class="comment">----------</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>开启查看 <code>Pillar</code> 状态，一般不用打开</p></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# cd /etc/salt/</span><br><span class="line">[root@saltmaster ~]# vim /etc/salt/master</span><br><span class="line">...省略...</span><br><span class="line">#pillar_opts: <span class="literal">False</span></span><br><span class="line">改成</span><br><span class="line">pillar_opts: <span class="literal">True</span></span><br><span class="line">...省略...</span><br><span class="line">:wq保存退出</span><br><span class="line"></span><br><span class="line"># 重启 salt-master 服务</span><br><span class="line">systemctl restart salt-master</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@saltmaster</span> <span class="string">salt]#</span> <span class="string">salt</span> <span class="string">'fat-ydm01'</span> <span class="string">pillar.items</span></span><br><span class="line"><span class="attr">fat-ydm01:</span></span><br><span class="line"><span class="bullet">    -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">    master:</span></span><br><span class="line"><span class="bullet">        -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">        __role:</span></span><br><span class="line">            <span class="string">master</span></span><br><span class="line"><span class="attr">        auth_mode:</span></span><br><span class="line">            <span class="number">1</span></span><br><span class="line"><span class="attr">        auto_accept:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        cache_sreqs:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        cachedir:</span></span><br><span class="line">            <span class="string">/var/cache/salt/master</span></span><br><span class="line"><span class="attr">        cli_summary:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        client_acl:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">        client_acl_blacklist:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">        cluster_masters:</span></span><br><span class="line"><span class="attr">        cluster_mode:</span></span><br><span class="line">            <span class="string">paranoid</span></span><br><span class="line"><span class="attr">        con_cache:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        conf_file:</span></span><br><span class="line">            <span class="string">/etc/salt/master</span></span><br><span class="line"><span class="attr">        config_dir:</span></span><br><span class="line">            <span class="string">/etc/salt</span></span><br><span class="line"><span class="attr">        cython_enable:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        daemon:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        default_include:</span></span><br><span class="line">            <span class="string">master.d/*.conf</span></span><br><span class="line"><span class="attr">        enable_gpu_grains:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        enforce_mine_cache:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        enumerate_proxy_minions:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        environment:</span></span><br><span class="line">            <span class="string">None</span></span><br><span class="line"><span class="attr">        event_return:</span></span><br><span class="line"><span class="attr">        event_return_blacklist:</span></span><br><span class="line"><span class="attr">        event_return_queue:</span></span><br><span class="line">            <span class="number">0</span></span><br><span class="line"><span class="attr">        event_return_whitelist:</span></span><br><span class="line"><span class="attr">        ext_job_cache:</span></span><br><span class="line"><span class="attr">        ext_pillar:</span></span><br><span class="line"><span class="attr">        extension_modules:</span></span><br><span class="line">            <span class="string">/var/cache/salt/extmods</span></span><br><span class="line"><span class="attr">        external_auth:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">        failhard:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        file_buffer_size:</span></span><br><span class="line">            <span class="number">1048576</span></span><br><span class="line"><span class="attr">        file_client:</span></span><br><span class="line">            <span class="string">local</span></span><br><span class="line"><span class="attr">        file_ignore_glob:</span></span><br><span class="line">            <span class="string">None</span></span><br><span class="line"><span class="attr">        file_ignore_regex:</span></span><br><span class="line">            <span class="string">None</span></span><br><span class="line"><span class="attr">        file_recv:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        file_recv_max_size:</span></span><br><span class="line">            <span class="number">100</span></span><br><span class="line"><span class="attr">        file_roots:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">            base:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="string">/srv/salt</span></span><br><span class="line"><span class="attr">        fileserver_backend:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">roots</span></span><br><span class="line"><span class="attr">        fileserver_followsymlinks:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        fileserver_ignoresymlinks:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        fileserver_limit_traversal:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        gather_job_timeout:</span></span><br><span class="line">            <span class="number">10</span></span><br><span class="line"><span class="attr">        gitfs_base:</span></span><br><span class="line">            <span class="string">master</span></span><br><span class="line"><span class="attr">        gitfs_env_blacklist:</span></span><br><span class="line"><span class="attr">        gitfs_env_whitelist:</span></span><br><span class="line"><span class="attr">        gitfs_insecure_auth:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        gitfs_mountpoint:</span></span><br><span class="line"><span class="attr">        gitfs_passphrase:</span></span><br><span class="line"><span class="attr">        gitfs_password:</span></span><br><span class="line"><span class="attr">        gitfs_privkey:</span></span><br><span class="line"><span class="attr">        gitfs_pubkey:</span></span><br><span class="line"><span class="attr">        gitfs_remotes:</span></span><br><span class="line"><span class="attr">        gitfs_root:</span></span><br><span class="line"><span class="attr">        gitfs_user:</span></span><br><span class="line"><span class="attr">        hash_type:</span></span><br><span class="line">            <span class="string">md5</span></span><br><span class="line"><span class="attr">        hgfs_base:</span></span><br><span class="line">            <span class="string">default</span></span><br><span class="line"><span class="attr">        hgfs_branch_method:</span></span><br><span class="line">            <span class="string">branches</span></span><br><span class="line"><span class="attr">        hgfs_env_blacklist:</span></span><br><span class="line"><span class="attr">        hgfs_env_whitelist:</span></span><br><span class="line"><span class="attr">        hgfs_mountpoint:</span></span><br><span class="line"><span class="attr">        hgfs_remotes:</span></span><br><span class="line"><span class="attr">        hgfs_root:</span></span><br><span class="line"><span class="attr">        id:</span></span><br><span class="line">            <span class="string">fat-ydm01</span></span><br><span class="line"><span class="attr">        interface:</span></span><br><span class="line">            <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">        ioflo_console_logdir:</span></span><br><span class="line"><span class="attr">        ioflo_period:</span></span><br><span class="line">            <span class="number">0.01</span></span><br><span class="line"><span class="attr">        ioflo_realtime:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        ioflo_verbose:</span></span><br><span class="line">            <span class="number">0</span></span><br><span class="line"><span class="attr">        ipv6:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        jinja_lstrip_blocks:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        jinja_trim_blocks:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        job_cache:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        keep_jobs:</span></span><br><span class="line">            <span class="number">24</span></span><br><span class="line"><span class="attr">        key_logfile:</span></span><br><span class="line">            <span class="string">/var/log/salt/key</span></span><br><span class="line"><span class="attr">        keysize:</span></span><br><span class="line">            <span class="number">2048</span></span><br><span class="line"><span class="attr">        log_datefmt:</span></span><br><span class="line">            <span class="string">%H:%M:%S</span></span><br><span class="line"><span class="attr">        log_datefmt_logfile:</span></span><br><span class="line">            <span class="string">%Y-%m-%d</span> <span class="string">%H:%M:%S</span></span><br><span class="line"><span class="attr">        log_file:</span></span><br><span class="line">            <span class="string">/var/log/salt/master</span></span><br><span class="line"><span class="attr">        log_fmt_console:</span></span><br><span class="line">            <span class="string">[%(levelname)-8s]</span> <span class="string">%(message)s</span></span><br><span class="line"><span class="attr">        log_fmt_logfile:</span></span><br><span class="line">            <span class="string">%(asctime)s,%(msecs)03.0f</span> <span class="string">[%(name)-17s][%(levelname)-8s][%(process)d]</span> <span class="string">%(message)s</span></span><br><span class="line"><span class="attr">        log_granular_levels:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">        log_level:</span></span><br><span class="line">            <span class="string">warning</span></span><br><span class="line"><span class="attr">        loop_interval:</span></span><br><span class="line">            <span class="number">60</span></span><br><span class="line"><span class="attr">        maintenance_floscript:</span></span><br><span class="line">            <span class="string">/usr/lib/python2.7/site-packages/salt/daemons/flo/maint.flo</span></span><br><span class="line"><span class="attr">        master_floscript:</span></span><br><span class="line">            <span class="string">/usr/lib/python2.7/site-packages/salt/daemons/flo/master.flo</span></span><br><span class="line"><span class="attr">        master_job_cache:</span></span><br><span class="line">            <span class="string">local_cache</span></span><br><span class="line"><span class="attr">        master_pubkey_signature:</span></span><br><span class="line">            <span class="string">master_pubkey_signature</span></span><br><span class="line"><span class="attr">        master_roots:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">            base:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="string">/srv/salt-master</span></span><br><span class="line"><span class="attr">        master_sign_key_name:</span></span><br><span class="line">            <span class="string">master_sign</span></span><br><span class="line"><span class="attr">        master_sign_pubkey:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        master_tops:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">        master_use_pubkey_signature:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        max_event_size:</span></span><br><span class="line">            <span class="number">1048576</span></span><br><span class="line"><span class="attr">        max_minions:</span></span><br><span class="line">            <span class="number">0</span></span><br><span class="line"><span class="attr">        max_open_files:</span></span><br><span class="line">            <span class="number">100000</span></span><br><span class="line"><span class="attr">        minion_data_cache:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        minionfs_blacklist:</span></span><br><span class="line"><span class="attr">        minionfs_env:</span></span><br><span class="line">            <span class="string">base</span></span><br><span class="line"><span class="attr">        minionfs_mountpoint:</span></span><br><span class="line"><span class="attr">        minionfs_whitelist:</span></span><br><span class="line"><span class="attr">        nodegroups:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">        open_mode:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        order_masters:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        outputter_dirs:</span></span><br><span class="line"><span class="attr">        peer:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">        permissive_pki_access:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        pidfile:</span></span><br><span class="line">            <span class="string">/var/run/salt-master.pid</span></span><br><span class="line"><span class="attr">        pillar_opts:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        pillar_roots:</span></span><br><span class="line"><span class="bullet">            -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">            base:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="string">/srv/pillar</span></span><br><span class="line"><span class="attr">        pillar_safe_render_error:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        pillar_source_merging_strategy:</span></span><br><span class="line">            <span class="string">smart</span></span><br><span class="line"><span class="attr">        pillar_version:</span></span><br><span class="line">            <span class="number">2</span></span><br><span class="line"><span class="attr">        pillarenv:</span></span><br><span class="line">            <span class="string">None</span></span><br><span class="line"><span class="attr">        ping_on_rotate:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        pki_dir:</span></span><br><span class="line">            <span class="string">/etc/salt/pki/master</span></span><br><span class="line"><span class="attr">        preserve_minion_cache:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        pub_hwm:</span></span><br><span class="line">            <span class="number">1000</span></span><br><span class="line"><span class="attr">        publish_port:</span></span><br><span class="line">            <span class="number">4505</span></span><br><span class="line"><span class="attr">        publish_session:</span></span><br><span class="line">            <span class="number">86400</span></span><br><span class="line"><span class="attr">        queue_dirs:</span></span><br><span class="line"><span class="attr">        raet_alt_port:</span></span><br><span class="line">            <span class="number">4511</span></span><br><span class="line"><span class="attr">        raet_clear_remotes:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        raet_main:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        raet_mutable:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        raet_port:</span></span><br><span class="line">            <span class="number">4506</span></span><br><span class="line"><span class="attr">        range_server:</span></span><br><span class="line"><span class="attr">            range:</span><span class="number">80</span></span><br><span class="line"><span class="attr">        reactor:</span></span><br><span class="line"><span class="attr">        reactor_refresh_interval:</span></span><br><span class="line">            <span class="number">60</span></span><br><span class="line"><span class="attr">        reactor_worker_hwm:</span></span><br><span class="line">            <span class="number">10000</span></span><br><span class="line"><span class="attr">        reactor_worker_threads:</span></span><br><span class="line">            <span class="number">10</span></span><br><span class="line"><span class="attr">        renderer:</span></span><br><span class="line">            <span class="string">yaml_jinja</span></span><br><span class="line"><span class="attr">        ret_port:</span></span><br><span class="line">            <span class="number">4506</span></span><br><span class="line"><span class="attr">        root_dir:</span></span><br><span class="line">            <span class="string">/</span></span><br><span class="line"><span class="attr">        rotate_aes_key:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        runner_dirs:</span></span><br><span class="line"><span class="attr">        saltversion:</span></span><br><span class="line">            <span class="number">2015.5</span><span class="number">.10</span></span><br><span class="line"><span class="attr">        search:</span></span><br><span class="line"><span class="attr">        search_index_interval:</span></span><br><span class="line">            <span class="number">3600</span></span><br><span class="line"><span class="attr">        serial:</span></span><br><span class="line">            <span class="string">msgpack</span></span><br><span class="line"><span class="attr">        show_jid:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        show_timeout:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        sign_pub_messages:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        sock_dir:</span></span><br><span class="line">            <span class="string">/var/run/salt/master</span></span><br><span class="line"><span class="attr">        sqlite_queue_dir:</span></span><br><span class="line">            <span class="string">/var/cache/salt/master/queues</span></span><br><span class="line"><span class="attr">        ssh_passwd:</span></span><br><span class="line"><span class="attr">        ssh_port:</span></span><br><span class="line">            <span class="number">22</span></span><br><span class="line"><span class="attr">        ssh_scan_ports:</span></span><br><span class="line">            <span class="number">22</span></span><br><span class="line"><span class="attr">        ssh_scan_timeout:</span></span><br><span class="line">            <span class="number">0.01</span></span><br><span class="line"><span class="attr">        ssh_sudo:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        ssh_timeout:</span></span><br><span class="line">            <span class="number">60</span></span><br><span class="line"><span class="attr">        ssh_user:</span></span><br><span class="line">            <span class="string">root</span></span><br><span class="line"><span class="attr">        state_aggregate:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        state_auto_order:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        state_events:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        state_output:</span></span><br><span class="line">            <span class="string">full</span></span><br><span class="line"><span class="attr">        state_top:</span></span><br><span class="line"><span class="attr">            salt:</span><span class="string">//top.sls</span></span><br><span class="line"><span class="attr">        state_top_saltenv:</span></span><br><span class="line">            <span class="string">None</span></span><br><span class="line"><span class="attr">        state_verbose:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        sudo_acl:</span></span><br><span class="line">            <span class="literal">False</span></span><br><span class="line"><span class="attr">        svnfs_branches:</span></span><br><span class="line">            <span class="string">branches</span></span><br><span class="line"><span class="attr">        svnfs_env_blacklist:</span></span><br><span class="line"><span class="attr">        svnfs_env_whitelist:</span></span><br><span class="line"><span class="attr">        svnfs_mountpoint:</span></span><br><span class="line"><span class="attr">        svnfs_remotes:</span></span><br><span class="line"><span class="attr">        svnfs_root:</span></span><br><span class="line"><span class="attr">        svnfs_tags:</span></span><br><span class="line">            <span class="string">tags</span></span><br><span class="line"><span class="attr">        svnfs_trunk:</span></span><br><span class="line">            <span class="string">trunk</span></span><br><span class="line"><span class="attr">        syndic_dir:</span></span><br><span class="line">            <span class="string">/var/cache/salt/master/syndics</span></span><br><span class="line"><span class="attr">        syndic_event_forward_timeout:</span></span><br><span class="line">            <span class="number">0.5</span></span><br><span class="line"><span class="attr">        syndic_jid_forward_cache_hwm:</span></span><br><span class="line">            <span class="number">100</span></span><br><span class="line"><span class="attr">        syndic_master:</span></span><br><span class="line"><span class="attr">        syndic_max_event_process_time:</span></span><br><span class="line">            <span class="number">0.5</span></span><br><span class="line"><span class="attr">        syndic_wait:</span></span><br><span class="line">            <span class="number">5</span></span><br><span class="line"><span class="attr">        timeout:</span></span><br><span class="line">            <span class="number">5</span></span><br><span class="line"><span class="attr">        token_dir:</span></span><br><span class="line">            <span class="string">/var/cache/salt/master/tokens</span></span><br><span class="line"><span class="attr">        token_expire:</span></span><br><span class="line">            <span class="number">43200</span></span><br><span class="line"><span class="attr">        transport:</span></span><br><span class="line">            <span class="string">zeromq</span></span><br><span class="line"><span class="attr">        user:</span></span><br><span class="line">            <span class="string">root</span></span><br><span class="line"><span class="attr">        verify_env:</span></span><br><span class="line">            <span class="literal">True</span></span><br><span class="line"><span class="attr">        win_gitrepos:</span></span><br><span class="line"><span class="attr">            - https:</span><span class="string">//github.com/saltstack/salt-winrepo.git</span></span><br><span class="line"><span class="attr">        win_repo:</span></span><br><span class="line">            <span class="string">/srv/salt/win/repo</span></span><br><span class="line"><span class="attr">        win_repo_mastercachefile:</span></span><br><span class="line">            <span class="string">/srv/salt/win/repo/winrepo.p</span></span><br><span class="line"><span class="attr">        worker_floscript:</span></span><br><span class="line">            <span class="string">/usr/lib/python2.7/site-packages/salt/daemons/flo/worker.flo</span></span><br><span class="line"><span class="attr">        worker_threads:</span></span><br><span class="line">            <span class="number">5</span></span><br><span class="line"><span class="attr">        zmq_filtering:</span></span><br><span class="line">            <span class="literal">False</span></span><br></pre></td></tr></table></figure><h2 id="Pillar-应用场景"><a href="#Pillar-应用场景" class="headerlink" title="Pillar 应用场景"></a>Pillar 应用场景</h2><p>用于敏感数据，给某一个配置文件设置一个密码，这个密码只希望指定 minion 能看到<br>使用 Pillar 来处理变量差异性</p><h2 id="定义-Pillar-数据"><a href="#定义-Pillar-数据" class="headerlink" title="定义 Pillar 数据"></a>定义 Pillar 数据</h2><blockquote><p>打开 <code>pillar_roots</code> 配置<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]<span class="comment"># vim /etc/salt/master</span></span><br><span class="line"><span class="string">...</span>省略<span class="string">...</span></span><br><span class="line">pillar_roots:</span><br><span class="line">  base:</span><br><span class="line">    - <span class="string">/srv/pillar</span></span><br><span class="line"><span class="string">...</span>省略<span class="string">...</span></span><br><span class="line"><span class="function">:wq</span> 保存退出</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启 salt-master 服务</span></span><br><span class="line">systemctl restart salt-master</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>注意：<code>base</code> 环境是必须有的基础环境，和 <code>topfile</code> 里是对应的<br>可以配置多个环境<br>存放在 <code>/srv/pillar</code> 目录下<br><code>Pillar</code> 也有 <code>topfile</code>，可以指定哪个 <code>Minion</code> 能看到哪一个<br><code>topfile</code> 必须放在 <code>base</code> 环境下</p></blockquote><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># mkdir -pv /srv/pillar</span></span><br><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># cd /srv/pillar/</span></span><br><span class="line">[root<span class="symbol">@saltmaster</span> pillar]<span class="meta"># vim /srv/pillar/apache.sls</span></span><br><span class="line">&#123;% <span class="keyword">if</span> grains[<span class="string">'os'</span>] == <span class="string">'CentOS'</span> %&#125;</span><br><span class="line">apache: httpd</span><br><span class="line">&#123;% elif grains[<span class="string">'os'</span>] == <span class="string">'Debian'</span> %&#125;</span><br><span class="line">apache: apache2</span><br><span class="line">&#123;% <span class="keyword">endif</span> %&#125;</span><br><span class="line">:wq 保存退出</span><br></pre></td></tr></table></figure><blockquote><p>将 apache.sls 指定哪个 Minion 能看到<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@saltmaster ~</span>]<span class="meta"># cd /srv/pillar/</span></span><br><span class="line">[<span class="meta">root@saltmaster pillar</span>]<span class="meta"># vim /srv/pillar/top.sls</span></span><br><span class="line"><span class="keyword">base</span>:</span><br><span class="line">  <span class="string">'*'</span>:</span><br><span class="line">    - apache</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>让所有机器都能看到这个 apache.sls 的 Pillar</p></blockquote><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster pillar]<span class="meta"># salt <span class="string">'*'</span> pillar.items</span></span><br><span class="line"><span class="symbol">dbfw01:</span></span><br><span class="line">    ----------</span><br><span class="line"><span class="symbol">    apache:</span></span><br><span class="line">        httpd</span><br><span class="line">fat-ydm01:</span><br><span class="line">    ----------</span><br><span class="line"><span class="symbol">    apache:</span></span><br><span class="line">        httpd</span><br></pre></td></tr></table></figure><blockquote><p>获取到了 apache 的 pillar，值都是 httpd，因为都是 CentOS 的机器，如果是 Ubuntu 的机器就会显示 apache2</p></blockquote><p><strong>Pillar 主要用于做配置管理，用来定义一些变量和参数，比如：主机名，IP</strong></p><h2 id="Pillar-定位主机"><a href="#Pillar-定位主机" class="headerlink" title="Pillar 定位主机"></a>Pillar 定位主机</h2><blockquote><p><code>-I, --pillar</code> 表示使用 Pillar 来匹配<br>设置完 Pillar 后，需要刷新 Pillar 数据信息，使其生效<br><code>salt &#39;*&#39; saltutil.refresh_pillar</code></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@saltmaster</span> <span class="string">pillar]#</span> <span class="string">salt</span> <span class="string">'*'</span> <span class="string">saltutil.refresh_pillar</span></span><br><span class="line"><span class="attr">dbfw01:</span></span><br><span class="line">    <span class="literal">True</span></span><br><span class="line"><span class="attr">fat-ydm01:</span></span><br><span class="line">    <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="string">[root@saltmaster</span> <span class="string">pillar]#</span> <span class="string">salt</span> <span class="bullet">-I</span> <span class="string">'apache:httpd'</span> <span class="string">test.ping</span></span><br><span class="line"><span class="attr">dbfw01:</span></span><br><span class="line">    <span class="literal">True</span></span><br><span class="line"><span class="attr">fat-ydm01:</span></span><br><span class="line">    <span class="literal">True</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SaltStack-数据系统-Pillar&quot;&gt;&lt;a href=&quot;#SaltStack-数据系统-Pillar&quot; class=&quot;headerlink&quot; title=&quot;SaltStack 数据系统 Pillar&quot;&gt;&lt;/a&gt;SaltStack 数据系统 Pillar&lt;/h1&gt;
    
    </summary>
    
      <category term="SaltStack笔记" scheme="http://www.gmlyo.com/categories/SaltStack%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="SaltStack 数据系统 Pillar" scheme="http://www.gmlyo.com/tags/SaltStack-%E6%95%B0%E6%8D%AE%E7%B3%BB%E7%BB%9F-Pillar/"/>
    
  </entry>
  
  <entry>
    <title>SaltStack states sls 状态管理</title>
    <link href="http://www.gmlyo.com/2018/09/06/SaltStack-states-sls-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/"/>
    <id>http://www.gmlyo.com/2018/09/06/SaltStack-states-sls-状态管理/</id>
    <published>2018-09-05T17:58:05.000Z</published>
    <updated>2018-09-06T13:29:28.012Z</updated>
    
    <content type="html"><![CDATA[<h2 id="SaltStack-states-sls-状态管理"><a href="#SaltStack-states-sls-状态管理" class="headerlink" title="SaltStack states sls 状态管理"></a>SaltStack states sls 状态管理</h2><a id="more"></a><h3 id="开启-file-roots-状态管理"><a href="#开启-file-roots-状态管理" class="headerlink" title="开启 file_roots 状态管理"></a>开启 file_roots 状态管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# cd /etc/salt/</span><br><span class="line">[root@saltmaster salt]# vim /etc/salt/master</span><br><span class="line">...省略...</span><br><span class="line"><span class="meta">#</span><span class="bash"> file_roots:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   base:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     - /srv/salt/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   dev:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     - /srv/salt/dev/services</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     - /srv/salt/dev/states</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   prod:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     - /srv/salt/prod/services</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     - /srv/salt/prod/states</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">file_roots:        # 打开这段注释</span><br><span class="line">  base:</span><br><span class="line">    - /srv/salt</span><br><span class="line">...省略...</span><br><span class="line">:wq保存退出</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 mkdir -pv /srv/salt 目录</span></span><br><span class="line">[root@saltmaster ~]# mkdir -pv /srv/salt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启 Master端服务</span></span><br><span class="line">systemctl restart salt-master</span><br></pre></td></tr></table></figure><blockquote><p>默认必须有一个 base 环境<br>可以指定多个环境：基准环境(base)，开发环境(dev)，生产环境(prod)</p></blockquote><h3 id="编辑-sls-状态配置"><a href="#编辑-sls-状态配置" class="headerlink" title="编辑 sls 状态配置"></a>编辑 sls 状态配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@saltmaster</span> <span class="string">~]#</span> <span class="string">cd</span> <span class="string">/srv/salt/</span></span><br><span class="line"><span class="string">[root@saltmaster</span> <span class="string">salt]#</span> <span class="string">vim</span> <span class="string">/srv/salt/nginx.sls</span></span><br><span class="line"><span class="attr">nginx-install:</span>       <span class="comment"># 自定义名称</span></span><br><span class="line">  <span class="string">pkg.installed:</span>     <span class="comment"># 模块.方法</span></span><br><span class="line"><span class="attr">    - names:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="attr">nginx-servcice:</span>      <span class="comment"># 自定义名称</span></span><br><span class="line">  <span class="string">service.running:</span>   <span class="comment"># 模块.方法</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">nginx</span>    <span class="comment"># nginx 服务名</span></span><br><span class="line"><span class="attr">    - enable:</span> <span class="literal">True</span>   <span class="comment"># 开机自启</span></span><br><span class="line"><span class="attr">    - reload:</span> <span class="literal">True</span>   <span class="comment"># 开启重新加载</span></span><br></pre></td></tr></table></figure><blockquote><p>执行<br><code>salt &#39;*&#39; 模块.方法 sls文件</code><br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># salt <span class="string">'*'</span> state.sls nginx</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>salt ‘*’ 意思是在所有机器上执行  nginx 这个状态(sls)</p></blockquote><blockquote><p>如果没有指定 <code>-name: nginx</code> 服务名，会报 Result 失败<br>命名服务 <code>nginx-service</code> 不可用，因为会把 <code>nginx-service</code> 当成服务名<br>另一个办法是把 <code>nginx-service</code> 改成 <code>nginx</code>，<code>-name: nginx</code> 就不用写了<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">----------</span><br><span class="line">          ID: nginx-service</span><br><span class="line">    Function: service.running</span><br><span class="line">      Result: <span class="literal">False</span></span><br><span class="line">     Comment: The named<span class="built_in"> service </span>nginx-service is <span class="keyword">not</span> available</span><br><span class="line">     Started: 01:38:22.609850</span><br><span class="line">    Duration: 108.528 ms</span><br><span class="line">     Changes:</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>salt ‘fat-ydm01’ 指定在 fat-ydm01 机器上执行  nginx 这个状态(sls)<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@saltmaster</span> <span class="string">~]#</span> <span class="string">salt</span> <span class="string">'fat-ydm01'</span> <span class="string">state.sls</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">fat-ydm01:</span></span><br><span class="line"><span class="bullet">-</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">          ID:</span> <span class="string">nginx-install</span></span><br><span class="line"><span class="attr">    Function:</span> <span class="string">pkg.installed</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">      Result:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">     Comment:</span> <span class="string">The</span> <span class="string">following</span> <span class="string">packages</span> <span class="string">were</span> <span class="string">installed/updated:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">     Started:</span> <span class="number">01</span><span class="string">:40:29.448702</span></span><br><span class="line"><span class="attr">    Duration:</span> <span class="number">8950.813</span> <span class="string">ms</span></span><br><span class="line"><span class="attr">     Changes:</span>   </span><br><span class="line"><span class="bullet">              -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">              nginx:</span></span><br><span class="line"><span class="bullet">                  -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">                  new:</span></span><br><span class="line">                      <span class="number">1</span><span class="string">:1.12.2-2.el7</span></span><br><span class="line"><span class="attr">                  old:</span></span><br><span class="line"><span class="attr">              nginx-all-modules:</span></span><br><span class="line"><span class="bullet">                  -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">                  new:</span></span><br><span class="line">                      <span class="number">1</span><span class="string">:1.12.2-2.el7</span></span><br><span class="line"><span class="attr">                  old:</span></span><br><span class="line"><span class="attr">              nginx-mod-http-geoip:</span></span><br><span class="line"><span class="bullet">                  -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">                  new:</span></span><br><span class="line">                      <span class="number">1</span><span class="string">:1.12.2-2.el7</span></span><br><span class="line"><span class="attr">                  old:</span></span><br><span class="line"><span class="attr">              nginx-mod-http-image-filter:</span></span><br><span class="line"><span class="bullet">                  -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">                  new:</span></span><br><span class="line">                      <span class="number">1</span><span class="string">:1.12.2-2.el7</span></span><br><span class="line"><span class="attr">                  old:</span></span><br><span class="line"><span class="attr">              nginx-mod-http-perl:</span></span><br><span class="line"><span class="bullet">                  -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">                  new:</span></span><br><span class="line">                      <span class="number">1</span><span class="string">:1.12.2-2.el7</span></span><br><span class="line"><span class="attr">                  old:</span></span><br><span class="line"><span class="attr">              nginx-mod-http-xslt-filter:</span></span><br><span class="line"><span class="bullet">                  -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">                  new:</span></span><br><span class="line">                      <span class="number">1</span><span class="string">:1.12.2-2.el7</span></span><br><span class="line"><span class="attr">                  old:</span></span><br><span class="line"><span class="attr">              nginx-mod-mail:</span></span><br><span class="line"><span class="bullet">                  -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">                  new:</span></span><br><span class="line">                      <span class="number">1</span><span class="string">:1.12.2-2.el7</span></span><br><span class="line"><span class="attr">                  old:</span></span><br><span class="line"><span class="attr">              nginx-mod-stream:</span></span><br><span class="line"><span class="bullet">                  -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">                  new:</span></span><br><span class="line">                      <span class="number">1</span><span class="string">:1.12.2-2.el7</span></span><br><span class="line"><span class="attr">                  old:</span></span><br><span class="line"><span class="bullet">-</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">          ID:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    Function:</span> <span class="string">service.running</span></span><br><span class="line"><span class="attr">      Result:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">     Comment:</span> <span class="string">Service</span> <span class="string">nginx</span> <span class="string">has</span> <span class="string">been</span> <span class="string">enabled,</span> <span class="string">and</span> <span class="string">is</span> <span class="string">running</span></span><br><span class="line"><span class="attr">     Started:</span> <span class="number">01</span><span class="string">:40:38.412396</span></span><br><span class="line"><span class="attr">    Duration:</span> <span class="number">732.741</span> <span class="string">ms</span></span><br><span class="line"><span class="attr">     Changes:</span>   </span><br><span class="line"><span class="bullet">              -</span><span class="bullet">---------</span></span><br><span class="line"><span class="attr">              nginx:</span></span><br><span class="line">                  <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="string">Summary</span></span><br><span class="line"><span class="bullet">-</span><span class="bullet">-----------</span></span><br><span class="line"><span class="attr">Succeeded:</span> <span class="number">2</span> <span class="string">(changed=2)</span></span><br><span class="line"><span class="attr">Failed:</span>    <span class="number">0</span></span><br><span class="line"><span class="bullet">-</span><span class="bullet">-----------</span></span><br><span class="line"><span class="string">Total</span> <span class="string">states</span> <span class="attr">run:</span>     <span class="number">2</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>在 Minion 端查看</p></blockquote><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@fat</span>-ydm01 ~]<span class="meta"># watch <span class="string">'ps -ef | grep yum'</span></span></span><br><span class="line">[root<span class="symbol">@fat</span>-ydm01 ~]<span class="meta"># lsof -i:80</span></span><br></pre></td></tr></table></figure><blockquote><p>一台机器可能不止一种状态(sls)配置，可能有多个状态(sls)配置<br>可以使用高级状态(sls)配置<br>写一个入口文件 topfile<br>一般入口文件名为 top.sls<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># vim /srv/salt/top.sls</span></span><br><span class="line">base:           <span class="meta"># 在 base 下</span></span><br><span class="line">  <span class="string">'*'</span>:          <span class="meta"># 在 <span class="string">'*'</span> 所有主机上</span></span><br><span class="line">    - nginx     <span class="meta"># 执行 nginx 这个 sls</span></span><br></pre></td></tr></table></figure></p></blockquote><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@saltmaster ~</span>]<span class="meta"># vim /srv/salt/top.sls</span></span><br><span class="line"><span class="keyword">base</span>:            <span class="meta"># 在 base 下</span></span><br><span class="line">  <span class="string">'fat-ydm01'</span>:   <span class="meta"># 在 fat-ydm01 主机上</span></span><br><span class="line">    - nginx      <span class="meta"># 执行 nginx 这个 sls</span></span><br></pre></td></tr></table></figure><blockquote><p>执行<br><code>salt &#39;*&#39; 模块.高级状态</code></p></blockquote><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># salt <span class="string">'*'</span> state.highstate</span></span><br></pre></td></tr></table></figure><blockquote><p>从入口文件开始读，从 topfile 开始读<br>topfile 里包含了哪些普通状态(sls)，就执行哪些状态(sls)<br>远程执行，状态管理</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;SaltStack-states-sls-状态管理&quot;&gt;&lt;a href=&quot;#SaltStack-states-sls-状态管理&quot; class=&quot;headerlink&quot; title=&quot;SaltStack states sls 状态管理&quot;&gt;&lt;/a&gt;SaltStack states sls 状态管理&lt;/h2&gt;
    
    </summary>
    
      <category term="SaltStack笔记" scheme="http://www.gmlyo.com/categories/SaltStack%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="SaltStack states sls 状态管理" scheme="http://www.gmlyo.com/tags/SaltStack-states-sls-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>SaltStack 数据系统 Grains</title>
    <link href="http://www.gmlyo.com/2018/09/06/SaltStack-%E6%95%B0%E6%8D%AE%E7%B3%BB%E7%BB%9F-Grains/"/>
    <id>http://www.gmlyo.com/2018/09/06/SaltStack-数据系统-Grains/</id>
    <published>2018-09-05T17:47:13.000Z</published>
    <updated>2018-09-06T07:28:12.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SaltStack-数据系统-Grains"><a href="#SaltStack-数据系统-Grains" class="headerlink" title="SaltStack 数据系统 Grains"></a>SaltStack 数据系统 Grains</h1><a id="more"></a><table><thead><tr><th>名称</th><th>存储位置</th><th>数据类型</th><th>数据采集更新方式</th><th>应用</th></tr></thead><tbody><tr><td>Grains</td><td>Minion端</td><td>静态数据</td><td>Minion启动时收集，也可以使用 saltutil.sync_grains 进行刷新</td><td>存储 Minion 基本数据，比如用于匹配 Minion，自身数据可以用来作资产管理等。</td></tr><tr><td>Pillar</td><td>Master端</td><td>动态数据</td><td>在Master端定义，指定给对应的Minion。可以使用 saltutil.refresh_pillar 刷新</td><td>存储 Master 指定的数据，只有指定的 Minion 可以看到。用于敏感数据保存。</td></tr></tbody></table><blockquote><p>Grains 存放 minion 启动时收集的系统信息<br>Grains 是存储在 minion 端的<br>只有在 minion 启动时才会进行收集，收集完之后就不变了，等下一次 minion 重启，才会变<br>Grains 收集的数据信息称之为静态数据，重启才会收集，不重启就不变</p></blockquote><blockquote><p>Grains 在做配置部署的过程中会经常使用到它，Grains 是 SaltStack 记录 Minion 的一些静态信息的组件，我们可以简单地理解为 Grains 里面记录着每台 Minion 的一些常用属性，比如 CPU、内存、磁盘、网络信息等，我们可以通过 <code>granis.items</code> 查看某台 Minion 的所有 Grains 信息，Minion 的 Grains 信息是 Minion 启动的时候采集汇报给 Master 的，在实际应用环境中我们需要根据自己的业务需求去自定义一些 Grains，关于自定义 Grains 的常用方法有以下几种：</p><ul><li>通过 Minion 配置文件定义</li><li>通过 Grains 相关模块定义</li><li>通过 Python 脚本定义</li></ul></blockquote><blockquote><p>查看 Grains 方法列表<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# salt 'fat-ydm*' sys.list_functions grains</span><br><span class="line">fat-ydm01:</span><br><span class="line">    -<span class="ruby"> grains.append</span></span><br><span class="line"><span class="ruby">    - grains.delval</span></span><br><span class="line"><span class="ruby">    - grains.filter_by</span></span><br><span class="line"><span class="ruby">    - grains.get</span></span><br><span class="line"><span class="ruby">    - grains.get_or_set_hash</span></span><br><span class="line"><span class="ruby">    - grains.has_value</span></span><br><span class="line"><span class="ruby">    - grains.item</span></span><br><span class="line"><span class="ruby">    - grains.items</span></span><br><span class="line"><span class="ruby">    - grains.ls</span></span><br><span class="line"><span class="ruby">    - grains.remove</span></span><br><span class="line"><span class="ruby">    - grains.setval</span></span><br><span class="line"><span class="ruby">    - grains.setvals</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>详细用法与例子可以通过以下命令查看</p></blockquote><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]<span class="meta"># salt 'fat-ydm*' sys.doc grains</span></span><br><span class="line"><span class="comment">'grains.append:'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">New</span> <span class="keyword">in</span> version <span class="number">0.17</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">    Append a value <span class="keyword">to</span> a list <span class="keyword">in</span> the grains config file. <span class="keyword">If</span> the grain doesn<span class="comment">'t</span></span><br><span class="line">    exist, the grain <span class="keyword">key</span> <span class="keyword">is</span> added <span class="keyword">and</span> the value <span class="keyword">is</span> appended <span class="keyword">to</span> the <span class="keyword">new</span> grain</span><br><span class="line">    <span class="keyword">as</span> a list item.</span><br><span class="line"></span><br><span class="line">    <span class="keyword">key</span></span><br><span class="line">        The grain <span class="keyword">key</span> <span class="keyword">to</span> be appended <span class="keyword">to</span></span><br><span class="line"></span><br><span class="line">    val</span><br><span class="line">        The value <span class="keyword">to</span> append <span class="keyword">to</span> the grain <span class="keyword">key</span></span><br><span class="line">...省略...</span><br><span class="line"><span class="comment">'grains.setvals:'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Set</span> <span class="keyword">new</span> grains values <span class="keyword">in</span> the grains config file</span><br><span class="line"></span><br><span class="line">    :param Destructive: <span class="keyword">If</span> an operation results <span class="keyword">in</span> a <span class="keyword">key</span> being removed, delete the <span class="keyword">key</span>, too. Defaults <span class="keyword">to</span> <span class="literal">False</span>.</span><br><span class="line"></span><br><span class="line">    CLI Example:</span><br><span class="line"></span><br><span class="line">        salt <span class="comment">'*' grains.setvals "&#123;'key1': 'val1', 'key2': 'val2'&#125;"</span></span><br></pre></td></tr></table></figure><blockquote><p>通过 <code>sys.doc</code> 查看 <code>grains模块.items方法</code> 的使用方法</p></blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# salt <span class="symbol">'fat</span>-ydm*' sys.doc grains.items</span><br><span class="line"><span class="symbol">'grains.items</span>:'</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Return</span> <span class="keyword">all</span> <span class="keyword">of</span> the minion<span class="symbol">'s</span> grains</span><br><span class="line"></span><br><span class="line">    CLI Example:</span><br><span class="line"></span><br><span class="line">        salt <span class="string">'*'</span> grains.items</span><br><span class="line"></span><br><span class="line">    Sanitized CLI Example:</span><br><span class="line"></span><br><span class="line">        salt <span class="string">'*'</span> grains.items sanitize=<span class="literal">True</span></span><br></pre></td></tr></table></figure><h2 id="Grains-应用场景"><a href="#Grains-应用场景" class="headerlink" title="Grains 应用场景"></a>Grains 应用场景</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><h4 id="列出-Grains-所有的-key"><a href="#列出-Grains-所有的-key" class="headerlink" title="列出 Grains 所有的 key"></a>列出 Grains 所有的 key</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# salt 'fat-ydm*' grains.ls</span><br><span class="line">fat-ydm01:</span><br><span class="line">    -<span class="ruby"> SSDs</span></span><br><span class="line"><span class="ruby">    - biosreleasedate</span></span><br><span class="line"><span class="ruby">    - biosversion</span></span><br><span class="line"><span class="ruby">    - cpu_flags</span></span><br><span class="line"><span class="ruby">    - cpu_model</span></span><br><span class="line"><span class="ruby">    - cpuarch</span></span><br><span class="line"><span class="ruby">    - domain</span></span><br><span class="line"><span class="ruby">    - fqdn</span></span><br><span class="line"><span class="ruby">    - fqdn_ip4</span></span><br><span class="line"><span class="ruby">    - fqdn_ip6</span></span><br><span class="line"><span class="ruby">    - gpus</span></span><br><span class="line"><span class="ruby">    - host</span></span><br><span class="line"><span class="ruby">    - hwaddr_interfaces</span></span><br><span class="line"><span class="ruby">    - id</span></span><br><span class="line"><span class="ruby">    - init</span></span><br><span class="line"><span class="ruby">    - ip4_interfaces</span></span><br><span class="line"><span class="ruby">    - ip6_interfaces</span></span><br><span class="line"><span class="ruby">    - ip_interfaces</span></span><br><span class="line"><span class="ruby">    - ipv4</span></span><br><span class="line"><span class="ruby">    - ipv6</span></span><br><span class="line"><span class="ruby">    - kernel</span></span><br><span class="line"><span class="ruby">    - kernelrelease</span></span><br><span class="line"><span class="ruby">    - locale_info</span></span><br><span class="line"><span class="ruby">    - localhost</span></span><br><span class="line"><span class="ruby">    - lsb_distrib_id</span></span><br><span class="line"><span class="ruby">    - machine_id</span></span><br><span class="line"><span class="ruby">    - manufacturer</span></span><br><span class="line"><span class="ruby">    - master</span></span><br><span class="line"><span class="ruby">    - mdadm</span></span><br><span class="line"><span class="ruby">    - mem_total</span></span><br><span class="line"><span class="ruby">    - nodename</span></span><br><span class="line"><span class="ruby">    - num_cpus</span></span><br><span class="line"><span class="ruby">    - num_gpus</span></span><br><span class="line"><span class="ruby">    - os</span></span><br><span class="line"><span class="ruby">    - os_family</span></span><br><span class="line"><span class="ruby">    - osarch</span></span><br><span class="line"><span class="ruby">    - oscodename</span></span><br><span class="line"><span class="ruby">    - osfinger</span></span><br><span class="line"><span class="ruby">    - osfullname</span></span><br><span class="line"><span class="ruby">    - osmajorrelease</span></span><br><span class="line"><span class="ruby">    - osrelease</span></span><br><span class="line"><span class="ruby">    - osrelease_info</span></span><br><span class="line"><span class="ruby">    - path</span></span><br><span class="line"><span class="ruby">    - productname</span></span><br><span class="line"><span class="ruby">    - ps</span></span><br><span class="line"><span class="ruby">    - pythonexecutable</span></span><br><span class="line"><span class="ruby">    - pythonpath</span></span><br><span class="line"><span class="ruby">    - pythonversion</span></span><br><span class="line"><span class="ruby">    - saltpath</span></span><br><span class="line"><span class="ruby">    - saltversion</span></span><br><span class="line"><span class="ruby">    - saltversioninfo</span></span><br><span class="line"><span class="ruby">    - selinux</span></span><br><span class="line"><span class="ruby">    - serialnumber</span></span><br><span class="line"><span class="ruby">    - server_id</span></span><br><span class="line"><span class="ruby">    - shell</span></span><br><span class="line"><span class="ruby">    - systemd</span></span><br><span class="line"><span class="ruby">    - virtual</span></span><br><span class="line"><span class="ruby">    - zmqversion</span></span><br></pre></td></tr></table></figure><h4 id="显示-grains-所有内容信息"><a href="#显示-grains-所有内容信息" class="headerlink" title="显示 grains 所有内容信息"></a>显示 grains 所有内容信息</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# salt 'fat-ydm*' grains.items</span><br><span class="line">fat-ydm01:</span><br><span class="line">    -<span class="ruby">---------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">SSDs:</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">biosreleasedate:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">04</span>/<span class="number">01</span>/<span class="number">2014</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">biosversion:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">1.11</span>.<span class="number">0</span>-<span class="number">2</span>.el7</span></span><br><span class="line"><span class="ruby">    <span class="symbol">cpu_flags:</span></span></span><br><span class="line"><span class="ruby">        - fpu</span></span><br><span class="line"><span class="ruby">        - de</span></span><br><span class="line"><span class="ruby">        - pse</span></span><br><span class="line"><span class="ruby">        - tsc</span></span><br><span class="line"><span class="ruby">        - msr</span></span><br><span class="line"><span class="ruby">        - pae</span></span><br><span class="line"><span class="ruby">        - mce</span></span><br><span class="line"><span class="ruby">        - cx8</span></span><br><span class="line"><span class="ruby">        - apic</span></span><br><span class="line"><span class="ruby">        - sep</span></span><br><span class="line"><span class="ruby">        - mtrr</span></span><br><span class="line"><span class="ruby">        - pge</span></span><br><span class="line"><span class="ruby">        - mca</span></span><br><span class="line"><span class="ruby">        - cmov</span></span><br><span class="line"><span class="ruby">        - pse36</span></span><br><span class="line"><span class="ruby">        - clflush</span></span><br><span class="line"><span class="ruby">        - mmx</span></span><br><span class="line"><span class="ruby">        - fxsr</span></span><br><span class="line"><span class="ruby">        - sse</span></span><br><span class="line"><span class="ruby">        - sse2</span></span><br><span class="line"><span class="ruby">        - ht</span></span><br><span class="line"><span class="ruby">        - syscall</span></span><br><span class="line"><span class="ruby">        - nx</span></span><br><span class="line"><span class="ruby">        - lm</span></span><br><span class="line"><span class="ruby">        - rep_good</span></span><br><span class="line"><span class="ruby">        - nopl</span></span><br><span class="line"><span class="ruby">        - pni</span></span><br><span class="line"><span class="ruby">        - cx16</span></span><br><span class="line"><span class="ruby">        - x2apic</span></span><br><span class="line"><span class="ruby">        - hypervisor</span></span><br><span class="line"><span class="ruby">        - lahf_lm</span></span><br><span class="line"><span class="ruby">    <span class="symbol">cpu_model:</span></span></span><br><span class="line"><span class="ruby">        QEMU Virtual CPU version <span class="number">2.5</span>+</span></span><br><span class="line"><span class="ruby">    <span class="symbol">cpuarch:</span></span></span><br><span class="line"><span class="ruby">        x86_64</span></span><br><span class="line"><span class="ruby">    <span class="symbol">domain:</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">fqdn:</span></span></span><br><span class="line"><span class="ruby">        fat-ydm01</span></span><br><span class="line"><span class="ruby">    <span class="symbol">fqdn_ip4:</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">192.168</span>.<span class="number">50.208</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">fqdn_ip6:</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">gpus:</span></span></span><br><span class="line"><span class="ruby">        <span class="params">|_</span></span></span><br><span class="line"><span class="ruby">          ----------</span></span><br><span class="line"><span class="ruby">          <span class="symbol">model:</span></span></span><br><span class="line"><span class="ruby">              GD <span class="number">5446</span></span></span><br><span class="line"><span class="ruby">          <span class="symbol">vendor:</span></span></span><br><span class="line"><span class="ruby">              unknown</span></span><br><span class="line"><span class="ruby">    <span class="symbol">host:</span></span></span><br><span class="line"><span class="ruby">        fat-ydm01</span></span><br><span class="line"><span class="ruby">    <span class="symbol">hwaddr_interfaces:</span></span></span><br><span class="line"><span class="ruby">        ----------</span></span><br><span class="line"><span class="ruby">        <span class="symbol">eth0:</span></span></span><br><span class="line"><span class="ruby">            <span class="symbol">fa:</span><span class="number">57</span><span class="symbol">:ad</span><span class="symbol">:</span><span class="number">54</span><span class="symbol">:</span><span class="number">77</span><span class="symbol">:</span><span class="number">00</span></span></span><br><span class="line"><span class="ruby">        <span class="symbol">lo:</span></span></span><br><span class="line"><span class="ruby">            <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">id:</span></span></span><br><span class="line"><span class="ruby">        fat-ydm01</span></span><br><span class="line"><span class="ruby">    <span class="symbol">init:</span></span></span><br><span class="line"><span class="ruby">        systemd</span></span><br><span class="line"><span class="ruby">    <span class="symbol">ip4_interfaces:</span></span></span><br><span class="line"><span class="ruby">        ----------</span></span><br><span class="line"><span class="ruby">        <span class="symbol">eth0:</span></span></span><br><span class="line"><span class="ruby">            - <span class="number">192.168</span>.<span class="number">50.171</span></span></span><br><span class="line"><span class="ruby">        <span class="symbol">lo:</span></span></span><br><span class="line"><span class="ruby">            - <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">ip6_interfaces:</span></span></span><br><span class="line"><span class="ruby">        ----------</span></span><br><span class="line"><span class="ruby">        <span class="symbol">eth0:</span></span></span><br><span class="line"><span class="ruby">        <span class="symbol">lo:</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">ip_interfaces:</span></span></span><br><span class="line"><span class="ruby">        ----------</span></span><br><span class="line"><span class="ruby">        <span class="symbol">eth0:</span></span></span><br><span class="line"><span class="ruby">            - <span class="number">192.168</span>.<span class="number">50.171</span></span></span><br><span class="line"><span class="ruby">        <span class="symbol">lo:</span></span></span><br><span class="line"><span class="ruby">            - <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">ipv4:</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">192.168</span>.<span class="number">50.171</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">ipv6:</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">kernel:</span></span></span><br><span class="line"><span class="ruby">        Linux</span></span><br><span class="line"><span class="ruby">    <span class="symbol">kernelrelease:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">3.10</span>.<span class="number">0</span>-<span class="number">862</span>.el7.x86_64</span></span><br><span class="line"><span class="ruby">    <span class="symbol">locale_info:</span></span></span><br><span class="line"><span class="ruby">        ----------</span></span><br><span class="line"><span class="ruby">        <span class="symbol">defaultencoding:</span></span></span><br><span class="line"><span class="ruby">            UTF-<span class="number">8</span></span></span><br><span class="line"><span class="ruby">        <span class="symbol">defaultlanguage:</span></span></span><br><span class="line"><span class="ruby">            en_US</span></span><br><span class="line"><span class="ruby">        <span class="symbol">detectedencoding:</span></span></span><br><span class="line"><span class="ruby">            UTF-<span class="number">8</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">localhost:</span></span></span><br><span class="line"><span class="ruby">        fat-ydm01</span></span><br><span class="line"><span class="ruby">    <span class="symbol">lsb_distrib_id:</span></span></span><br><span class="line"><span class="ruby">        CentOS Linux</span></span><br><span class="line"><span class="ruby">    <span class="symbol">machine_id:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">2</span>e1eda950cd34bdd9dc04c8df9294ae<span class="number">0</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">manufacturer:</span></span></span><br><span class="line"><span class="ruby">        Red Hat</span></span><br><span class="line"><span class="ruby">    <span class="symbol">master:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">192.168</span>.<span class="number">35.223</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">mdadm:</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">mem_total:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">3772</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">nodename:</span></span></span><br><span class="line"><span class="ruby">        fat-ydm01</span></span><br><span class="line"><span class="ruby">    <span class="symbol">num_cpus:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">2</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">num_gpus:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">1</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">os:</span></span></span><br><span class="line"><span class="ruby">        CentOS</span></span><br><span class="line"><span class="ruby">    <span class="symbol">os_family:</span></span></span><br><span class="line"><span class="ruby">        RedHat</span></span><br><span class="line"><span class="ruby">    <span class="symbol">osarch:</span></span></span><br><span class="line"><span class="ruby">        x86_64</span></span><br><span class="line"><span class="ruby">    <span class="symbol">oscodename:</span></span></span><br><span class="line"><span class="ruby">        Core</span></span><br><span class="line"><span class="ruby">    <span class="symbol">osfinger:</span></span></span><br><span class="line"><span class="ruby">        CentOS Linux-<span class="number">7</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">osfullname:</span></span></span><br><span class="line"><span class="ruby">        CentOS Linux</span></span><br><span class="line"><span class="ruby">    <span class="symbol">osmajorrelease:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">7</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">osrelease:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">7.5</span>.<span class="number">1804</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">osrelease_info:</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">7</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">5</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">1804</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">path:</span></span></span><br><span class="line"><span class="ruby">        /usr/local/<span class="symbol">sbin:</span>/usr/local/<span class="symbol">bin:</span>/usr/<span class="symbol">sbin:</span>/usr/bin</span></span><br><span class="line"><span class="ruby">    <span class="symbol">productname:</span></span></span><br><span class="line"><span class="ruby">        KVM</span></span><br><span class="line"><span class="ruby">    <span class="symbol">ps:</span></span></span><br><span class="line"><span class="ruby">        ps -efH</span></span><br><span class="line"><span class="ruby">    <span class="symbol">pythonexecutable:</span></span></span><br><span class="line"><span class="ruby">        /usr/bin/python</span></span><br><span class="line"><span class="ruby">    <span class="symbol">pythonpath:</span></span></span><br><span class="line"><span class="ruby">        - <span class="regexp">/usr/bin</span></span></span><br><span class="line"><span class="ruby">        - <span class="regexp">/usr/lib</span>64/python27.zip</span></span><br><span class="line"><span class="ruby">        - <span class="regexp">/usr/lib</span>64/python2.<span class="number">7</span></span></span><br><span class="line"><span class="ruby">        - <span class="regexp">/usr/lib</span>64/python2.<span class="number">7</span>/plat-linux2</span></span><br><span class="line"><span class="ruby">        - <span class="regexp">/usr/lib</span>64/python2.<span class="number">7</span>/lib-tk</span></span><br><span class="line"><span class="ruby">        - <span class="regexp">/usr/lib</span>64/python2.<span class="number">7</span>/lib-old</span></span><br><span class="line"><span class="ruby">        - <span class="regexp">/usr/lib</span>64/python2.<span class="number">7</span>/lib-dynload</span></span><br><span class="line"><span class="ruby">        - <span class="regexp">/usr/lib</span>64/python2.<span class="number">7</span>/site-packages</span></span><br><span class="line"><span class="ruby">        - <span class="regexp">/usr/lib</span><span class="regexp">/python2.7/site</span>-packages</span></span><br><span class="line"><span class="ruby">    <span class="symbol">pythonversion:</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">2</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">7</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">5</span></span></span><br><span class="line"><span class="ruby">        - final</span></span><br><span class="line"><span class="ruby">        - <span class="number">0</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">saltpath:</span></span></span><br><span class="line"><span class="ruby">        /usr/lib/python2.<span class="number">7</span>/site-packages/salt</span></span><br><span class="line"><span class="ruby">    <span class="symbol">saltversion:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">2015.5</span>.<span class="number">10</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">saltversioninfo:</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">2015</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">5</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">10</span></span></span><br><span class="line"><span class="ruby">        - <span class="number">0</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">selinux:</span></span></span><br><span class="line"><span class="ruby">        ----------</span></span><br><span class="line"><span class="ruby">        <span class="symbol">enabled:</span></span></span><br><span class="line"><span class="ruby">            False</span></span><br><span class="line"><span class="ruby">        <span class="symbol">enforced:</span></span></span><br><span class="line"><span class="ruby">            Disabled</span></span><br><span class="line"><span class="ruby">    <span class="symbol">serialnumber:</span></span></span><br><span class="line"><span class="ruby">        Not Specified</span></span><br><span class="line"><span class="ruby">    <span class="symbol">server_id:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">1223839238</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">shell:</span></span></span><br><span class="line"><span class="ruby">        /bin/sh</span></span><br><span class="line"><span class="ruby">    <span class="symbol">systemd:</span></span></span><br><span class="line"><span class="ruby">        ----------</span></span><br><span class="line"><span class="ruby">        <span class="symbol">features:</span></span></span><br><span class="line"><span class="ruby">            +PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN</span></span><br><span class="line"><span class="ruby">        <span class="symbol">version:</span></span></span><br><span class="line"><span class="ruby">            <span class="number">219</span></span></span><br><span class="line"><span class="ruby">    <span class="symbol">virtual:</span></span></span><br><span class="line"><span class="ruby">        kvm</span></span><br><span class="line"><span class="ruby">    <span class="symbol">zmqversion:</span></span></span><br><span class="line"><span class="ruby">        <span class="number">3.2</span>.<span class="number">5</span></span></span><br></pre></td></tr></table></figure><h4 id="显示某个信息内容"><a href="#显示某个信息内容" class="headerlink" title="显示某个信息内容"></a>显示某个信息内容</h4><blockquote><p>显示 <code>fqdn</code> 信息</p></blockquote><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># salt <span class="string">'fat-ydm*'</span> grains.item fqdn</span></span><br><span class="line">fat-ydm01:</span><br><span class="line">    ----------</span><br><span class="line">    fqdn:</span><br><span class="line">        fat-ydm01</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># salt <span class="string">'fat-ydm*'</span> grains.get fqdn</span></span><br><span class="line">fat-ydm01:</span><br><span class="line">    fat-ydm01</span><br></pre></td></tr></table></figure><blockquote><p>注意：<code>item</code> 和 <code>get</code> 显示的效果不同</p></blockquote><blockquote><p>查询 <code>eth0</code> 网卡信息<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># salt <span class="string">'fat-ydm*'</span> grains.get ip_interfaces:eth0</span></span><br><span class="line">fat-ydm01:</span><br><span class="line">    - <span class="number">192.168</span><span class="number">.50</span><span class="number">.171</span></span><br></pre></td></tr></table></figure></p></blockquote><h3 id="在-远程执行里-匹配-Minion"><a href="#在-远程执行里-匹配-Minion" class="headerlink" title="在 远程执行里 匹配 Minion"></a>在 远程执行里 匹配 Minion</h3><blockquote><p>在所有 CentOS 的机器上执行命令</p></blockquote><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# salt <span class="string">'fat-ydm*'</span> grains.item <span class="built_in">os</span></span><br><span class="line">fat-<span class="name">ydm01</span>:</span><br><span class="line">    <span class="comment">----------</span></span><br><span class="line">    <span class="name">os</span>:</span><br><span class="line">        CentOS</span><br><span class="line"></span><br><span class="line">[root@saltmaster ~]# salt <span class="string">'fat-ydm*'</span> grains.get <span class="built_in">os</span></span><br><span class="line">fat-<span class="name">ydm01</span>:</span><br><span class="line">    CentOS</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># salt <span class="string">'*'</span> grains.get osfinger</span></span><br><span class="line">dbfw01:</span><br><span class="line">    CentOS<span class="number">-6</span></span><br><span class="line">fat-ydm01:</span><br><span class="line">    CentOS Linux<span class="number">-7</span></span><br></pre></td></tr></table></figure><blockquote><p><code>-G：</code> 表示使用 Grains 来匹配<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]<span class="comment"># salt -G os:CentOS cmd.run 'w'</span></span><br><span class="line">fat-ydm01:</span><br><span class="line">     <span class="number">23</span>:<span class="number">59</span>:<span class="number">26</span> up <span class="number">27</span> days,  <span class="number">3</span>:<span class="number">00</span>,  <span class="number">0</span> users,  load average: <span class="number">0.01</span>, <span class="number">0.03</span>, <span class="number">0.05</span></span><br><span class="line">    <span class="keyword">USER</span>     <span class="title">TTY</span>      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br></pre></td></tr></table></figure></p></blockquote><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># salt -G osfinger:<span class="string">'CentOS Linux-7'</span> cmd.run <span class="string">'w'</span></span></span><br><span class="line">fat-ydm01:</span><br><span class="line">     <span class="number">00</span>:<span class="number">43</span>:<span class="number">03</span> up <span class="number">27</span> days,  <span class="number">3</span>:<span class="number">44</span>,  <span class="number">0</span> users,  load average: <span class="number">0.00</span>, <span class="number">0.01</span>, <span class="number">0.05</span></span><br><span class="line">    USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br></pre></td></tr></table></figure><blockquote><p>使用 Grains 可以来匹配主机</p></blockquote><h3 id="自定义-Grains"><a href="#自定义-Grains" class="headerlink" title="自定义 Grains"></a>自定义 Grains</h3><blockquote><p>当内置 Grains 满足不了需求时，可以自定义 Grains。<br>SaltStack 支持在 Minion 端通过配置文件的方式来自定义 Grains</p></blockquote><h4 id="通过-Minion-配置文件定义-Grains"><a href="#通过-Minion-配置文件定义-Grains" class="headerlink" title="通过 Minion 配置文件定义 Grains"></a>通过 Minion 配置文件定义 Grains</h4><blockquote><p>在 minion 端，编辑 <code>/etc/salt/minion</code><br>打开 <code>grains: roles:</code>  添加一行自定义 Grains 内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> grains:</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">   roles:</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">      - fat-ydm01-server</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# vim /etc/salt/minion</span><br><span class="line">...省略...</span><br><span class="line">grains:</span><br><span class="line">  roles:    # 角色</span><br><span class="line">     - fat-ydm-server    # 配置一个角色</span><br><span class="line">     - webserver    # 可以配置多个</span><br><span class="line">     - memcache</span><br><span class="line">...省略...</span><br><span class="line">:wq保存退出</span><br><span class="line"></span><br><span class="line"># 重启 salt-minion</span><br><span class="line">[root@saltmaster ~]# systemctl restart salt-minion</span><br></pre></td></tr></table></figure><blockquote><p>在 Master 端，在 <code>roles</code> 是 <code>fat-ydm-server</code> 的机器上，执行 <code>echo hello fat-ydm01</code></p></blockquote><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># salt -G <span class="string">'roles:fat-ydm-server'</span> cmd.run <span class="string">'echo hello fat-ydm01'</span></span></span><br><span class="line">fat-ydm01:</span><br><span class="line">    hello fat-ydm01</span><br></pre></td></tr></table></figure><blockquote><p>当配置 <code>/etc/salt/minion</code> 主配置文件，配置信息过多的情况下，可读性就会变差<br>我们可以另做一个配置 /etc/salt/grains 文件，专门来配置自定义 Grains<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@fat-ydm01 salt]# vim /etc/salt/grains</span><br><span class="line">roles:</span><br><span class="line">  -<span class="ruby"> fat-ydm-server</span></span><br><span class="line"><span class="ruby">  - fat-ydm-java</span></span><br><span class="line"><span class="ruby">  - fat-ydm-springboot</span></span><br><span class="line"><span class="ruby">  - fat-ydm-tomcat</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>Salt 默认会读取这个文件</p></blockquote><blockquote><p>推荐使用这种方式 <code>/etc/salt/minion.d/grains.conf</code><br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@fat-ydm01 salt]# vim /etc/salt/minion.d/grains.conf</span><br><span class="line">grains:</span><br><span class="line">  Server_business: Java, Web Site</span><br><span class="line">  Soft:</span><br><span class="line">    -<span class="ruby"> Tomcat</span></span><br><span class="line"><span class="ruby">    - Spring Boot</span></span><br><span class="line"><span class="ruby">  <span class="symbol">roles:</span></span></span><br><span class="line"><span class="ruby">    - fat-ydm-server</span></span><br><span class="line"><span class="ruby">  <span class="symbol">restful:</span></span></span><br><span class="line"><span class="ruby">    - fat-ydm-springboot</span></span><br><span class="line"><span class="ruby">  <span class="symbol">web:</span></span></span><br><span class="line"><span class="ruby">    - fat-ydm-tomcat</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>在 master 端执行<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# salt '*' grains.item roles</span><br><span class="line">dbfw01:</span><br><span class="line">    -<span class="ruby">---------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">roles:</span></span></span><br><span class="line"><span class="ruby">fat-<span class="symbol">ydm01:</span></span></span><br><span class="line"><span class="ruby">    ----------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">roles:</span></span></span><br><span class="line"><span class="ruby">        - fat-ydm-server</span></span><br><span class="line"><span class="ruby">        - fat-ydm-java</span></span><br><span class="line"><span class="ruby">        - fat-ydm-springboot</span></span><br><span class="line"><span class="ruby">        - fat-ydm-tomcat</span></span><br></pre></td></tr></table></figure></p></blockquote><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster hosts]# salt 'fat-ydm01' grains.item roles</span><br><span class="line">fat-ydm01:</span><br><span class="line">    -<span class="ruby">---------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">roles:</span></span></span><br><span class="line"><span class="ruby">        - fat-ydm-server</span></span><br><span class="line"><span class="ruby">[root@saltmaster hosts]<span class="comment"># salt 'fat-ydm01' grains.item Soft</span></span></span><br><span class="line"><span class="ruby">fat-<span class="symbol">ydm01:</span></span></span><br><span class="line"><span class="ruby">    ----------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">Soft:</span></span></span><br><span class="line"><span class="ruby">        - Tomcat</span></span><br><span class="line"><span class="ruby">        - Spring Boot</span></span><br><span class="line"><span class="ruby">[root@saltmaster hosts]<span class="comment"># salt 'fat-ydm01' grains.item Server_business</span></span></span><br><span class="line"><span class="ruby">fat-<span class="symbol">ydm01:</span></span></span><br><span class="line"><span class="ruby">    ----------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">Server_business:</span></span></span><br><span class="line"><span class="ruby">        Java, Web Site</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：<br>如果 <code>minion</code> 配置文件开着 <code>roles</code>，这里的 <code>roles</code> 名字就不能开着，否则会冲突<br>我们可以换个名字<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@fat-ydm01 salt]<span class="meta"># vim /etc/salt/grains</span></span><br><span class="line"><span class="symbol">restful:</span></span><br><span class="line">  - fat-ydm-springboot</span><br><span class="line"><span class="symbol">web:</span></span><br><span class="line">  - fat-ydm-tomcat</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>在 master 端执行<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]# salt '*' grains.item roles</span><br><span class="line">dbfw01:</span><br><span class="line">    -<span class="ruby">---------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">roles:</span></span></span><br><span class="line"><span class="ruby">fat-<span class="symbol">ydm01:</span></span></span><br><span class="line"><span class="ruby">    ----------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">roles:</span></span></span><br><span class="line"><span class="ruby">        - fat-ydm-server</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">[root@saltmaster ~]<span class="comment"># salt '*' grains.item restful</span></span></span><br><span class="line"><span class="ruby"><span class="symbol">dbfw01:</span></span></span><br><span class="line"><span class="ruby">    ----------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">restful:</span></span></span><br><span class="line"><span class="ruby">fat-<span class="symbol">ydm01:</span></span></span><br><span class="line"><span class="ruby">    ----------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">restful:</span></span></span><br><span class="line"><span class="ruby">        - fat-ydm-springboot</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">[root@saltmaster ~]<span class="comment"># salt '*' grains.item web</span></span></span><br><span class="line"><span class="ruby"><span class="symbol">dbfw01:</span></span></span><br><span class="line"><span class="ruby">    ----------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">web:</span></span></span><br><span class="line"><span class="ruby">fat-<span class="symbol">ydm01:</span></span></span><br><span class="line"><span class="ruby">    ----------</span></span><br><span class="line"><span class="ruby">    <span class="symbol">web:</span></span></span><br><span class="line"><span class="ruby">        - fat-ydm-tomcat</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">[root@saltmaster ~]<span class="comment"># salt -G web:fat-ydm-tomcat cmd.run 'w'</span></span></span><br><span class="line"><span class="ruby">fat-<span class="symbol">ydm01:</span></span></span><br><span class="line"><span class="ruby">     <span class="number">01</span><span class="symbol">:</span><span class="number">22</span><span class="symbol">:</span><span class="number">54</span> up <span class="number">27</span> days,  <span class="number">4</span><span class="symbol">:</span><span class="number">23</span>,  <span class="number">1</span> user,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">02</span>, <span class="number">0</span>.<span class="number">05</span></span></span><br><span class="line"><span class="ruby">    USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span></span><br><span class="line"><span class="ruby">    luming   pts/<span class="number">0</span>    <span class="number">192.168</span>.<span class="number">35.219</span>   <span class="number">00</span><span class="symbol">:</span><span class="number">50</span>    <span class="number">1</span><span class="symbol">:</span><span class="number">18</span>   <span class="number">0</span>.<span class="number">10</span>s  <span class="number">0</span>.<span class="number">00</span>s <span class="symbol">sshd:</span> luming [priv]</span></span><br></pre></td></tr></table></figure></p></blockquote><h3 id="在-topfile-里匹配-Minion"><a href="#在-topfile-里匹配-Minion" class="headerlink" title="在 topfile 里匹配 Minion"></a>在 topfile 里匹配 Minion</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@saltmaster</span> <span class="string">salt]#</span> <span class="string">vim</span> <span class="string">nginx.sls</span></span><br><span class="line"><span class="attr">nginx-install:</span></span><br><span class="line">  <span class="string">pkg.installed:</span></span><br><span class="line"><span class="attr">    - names:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="attr">nginx:</span></span><br><span class="line">  <span class="string">service.running:</span></span><br><span class="line"><span class="attr">    - enable:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">    - reload:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># vim /srv/salt/top.sls</span></span><br><span class="line">base:</span><br><span class="line">  <span class="string">'roles:fat-ydm-server'</span>:</span><br><span class="line">  <span class="meta"># <span class="string">'restful:fat-ydm-springboot'</span>:</span></span><br><span class="line">  <span class="meta"># <span class="string">'web:fat-ydm-tomcat'</span>:</span></span><br><span class="line">    - match: grain</span><br><span class="line">    - nginx</span><br><span class="line"></span><br><span class="line">[root<span class="symbol">@saltmaster</span> salt]<span class="meta"># salt <span class="string">'*'</span> state.highstate</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SaltStack-数据系统-Grains&quot;&gt;&lt;a href=&quot;#SaltStack-数据系统-Grains&quot; class=&quot;headerlink&quot; title=&quot;SaltStack 数据系统 Grains&quot;&gt;&lt;/a&gt;SaltStack 数据系统 Grains&lt;/h1&gt;
    
    </summary>
    
      <category term="SaltStack笔记" scheme="http://www.gmlyo.com/categories/SaltStack%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="SaltStack 数据系统 Grains" scheme="http://www.gmlyo.com/tags/SaltStack-%E6%95%B0%E6%8D%AE%E7%B3%BB%E7%BB%9F-Grains/"/>
    
  </entry>
  
  <entry>
    <title>SaltStack 基本架构</title>
    <link href="http://www.gmlyo.com/2018/09/04/SaltStack-%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84/"/>
    <id>http://www.gmlyo.com/2018/09/04/SaltStack-基本架构/</id>
    <published>2018-09-04T13:35:33.000Z</published>
    <updated>2018-09-05T05:21:52.815Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SaltStack-基本架构"><a href="#SaltStack-基本架构" class="headerlink" title="SaltStack 基本架构"></a>SaltStack 基本架构</h1><a id="more"></a><p>SaltStack 是一种基于 C/S 架构的服务模式。<br>在 SaltStack 架构中服务端叫作 Master，客户端叫作 Minion。<br>客户端发送请求给服务端，服务端接收到请求并且处理完成后再返回给客户端。</p><p>在 Master 和 Minion 端都是以守护进程的模式运行，一直监听配置文件里面定义的 ret_port（接受 minion 请求）和 publish_port（发布消息）的端口。当 Minion 运行时会自动连接到配置文件里面定义的 Master 地址 ret_port 端口进行连接认证。默认客户端请求 id 是 socket.getfqdn() 取到的值，也可以在 Minion 启动之前修改 Minion 的 id 值。关于整个启动通信过程，可以使用 debug 查看详细记录。</p><blockquote><p>Master端<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">salt-<span class="keyword">master</span> <span class="title">-l</span> debug</span><br><span class="line">ss -a | egrep '<span class="number">4505</span>|<span class="number">4506</span>'</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>Minion端<br><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">salt-minion -l <span class="keyword">debug</span></span><br></pre></td></tr></table></figure></p></blockquote><h2 id="4505-publish-port"><a href="#4505-publish-port" class="headerlink" title="4505(publish_port)"></a>4505(publish_port)</h2><blockquote><p>为 salt 的消息发布专用端口<br>为 Salt Master pub 接口，提供远程执行命令发送功能</p></blockquote><h2 id="4506-ret-port"><a href="#4506-ret-port" class="headerlink" title="4506(ret_port)"></a>4506(ret_port)</h2><blockquote><p>为客户端与服务端通信的端口。监控此端口可以监控哪些 minion 收到的消息，并回复了结果<br>为 Salt Master Ret 接口，支持认证(auth)，文件服务，结果收集等功能<br>要确保 客户端 能跟 服务端 的这 2 个端口通信，需要保证防火墙对于这两个端口是放开的</p></blockquote><p>Salt 架构中最主要的角色是 Salt master 和 Salt minion<br>另外一种角色是 syndic<br>顾名思义<br>master 是中心控制系统<br>minion 是被管理的客户端</p><h2 id="Salt-部署架构可以分为三种"><a href="#Salt-部署架构可以分为三种" class="headerlink" title="Salt 部署架构可以分为三种"></a>Salt 部署架构可以分为三种</h2><h3 id="第一种：master-gt-minion"><a href="#第一种：master-gt-minion" class="headerlink" title="第一种：master -&gt; minion"></a>第一种：master -&gt; minion</h3><p>这种架构中 master 和所有 minion 都直接连接，minion 接收来自 master 的指令，完成命令执行或配置管理</p><p><img src="http://pa2bdkuiw.bkt.clouddn.com/master_minion.png" alt="master_minion.png"></p><h3 id="第二种：master-gt-syndic-gt-minion"><a href="#第二种：master-gt-syndic-gt-minion" class="headerlink" title="第二种：master -&gt; syndic -&gt; minion"></a>第二种：master -&gt; syndic -&gt; minion</h3><p>这种架构中 master 通过 syndic 对 minion 进行管理，同时该架构可以进行多级扩展</p><p><img src="http://pa2bdkuiw.bkt.clouddn.com/master_syndic_minion.png" alt="master_syndic_minion.png"></p><h3 id="第三种：无-master-的-minion"><a href="#第三种：无-master-的-minion" class="headerlink" title="第三种：无 master 的 minion"></a>第三种：无 master 的 minion</h3><p>Masterless 架构，就不需要单独安装一台 SaltStack Master 机器，只需要在每台机器上安装 Minion，然后采用本机只负责对本机的配置管理工作机制服务模式。<br>这种架构中 minion 不受任何 master 控制，通过本地运行即可完成相关功能</p><p><img src="http://pa2bdkuiw.bkt.clouddn.com/minion.png" alt="minion.png"></p><p>Salt 的两个主要设计理念是 远程执行 和 配置管理。<br>Salt 中的 配置管理系统 可以称作 state，也是基于远程执行系统之上，通过 master 的定义可以让对应的 minion 达到想要的系统状态。</p><h2 id="SaltStack-软件依赖"><a href="#SaltStack-软件依赖" class="headerlink" title="SaltStack 软件依赖"></a>SaltStack 软件依赖</h2><p>SaltStack 有两种消息系统，一种是 RAET，另一种是 ZeroMQ，默认使用 ZeroMQ。</p><table><thead><tr><th>组件名</th><th>注释</th></tr></thead><tbody><tr><td>msgpack-python</td><td>SaltStack 消息交换库</td></tr><tr><td>YAML</td><td>SaltStack 配置解析定义语法</td></tr><tr><td>Jinja2</td><td>SaltStack states 配置模板</td></tr><tr><td>MarkupSafe</td><td>Python unicode 转换库</td></tr><tr><td>apache-libcloud</td><td>SaltStack 对云架构编排库</td></tr><tr><td>Requests</td><td>HTTP Python 库</td></tr><tr><td>ZeroMQ</td><td>SaltStack 消息系统</td></tr><tr><td>pyzmq</td><td>ZeroMQ Python 库</td></tr><tr><td>PyCrypto</td><td>Python 密码库</td></tr><tr><td>M2Crypto</td><td>Openssl Python 包装库</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SaltStack-基本架构&quot;&gt;&lt;a href=&quot;#SaltStack-基本架构&quot; class=&quot;headerlink&quot; title=&quot;SaltStack 基本架构&quot;&gt;&lt;/a&gt;SaltStack 基本架构&lt;/h1&gt;
    
    </summary>
    
      <category term="SaltStack笔记" scheme="http://www.gmlyo.com/categories/SaltStack%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="SaltStack 基本架构" scheme="http://www.gmlyo.com/tags/SaltStack-%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>SaltStack 认证配置</title>
    <link href="http://www.gmlyo.com/2018/09/04/SaltStack-%E8%AE%A4%E8%AF%81%E9%85%8D%E7%BD%AE/"/>
    <id>http://www.gmlyo.com/2018/09/04/SaltStack-认证配置/</id>
    <published>2018-09-04T10:26:09.000Z</published>
    <updated>2018-09-05T09:34:48.430Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SaltStack-认证配置"><a href="#SaltStack-认证配置" class="headerlink" title="SaltStack 认证配置"></a>SaltStack 认证配置</h1><a id="more"></a><h2 id="Salt-证书管理"><a href="#Salt-证书管理" class="headerlink" title="Salt 证书管理"></a>Salt 证书管理</h2><blockquote><p>SaltStack 使用 SSL 签发证书的方式进行安全认证。<br>在签发证书之前，可以在 Master 端看到 Minion 的证书签证请求。<br>Salt 和 minion 之间的认证关系是通过 salt-key 在 master 端管理的，生成证书记录在 <code>/etc/salt/pki/master/</code> 目录下</p></blockquote><h2 id="salt-minion-启动后生成秘钥文件"><a href="#salt-minion-启动后生成秘钥文件" class="headerlink" title="salt-minion 启动后生成秘钥文件"></a>salt-minion 启动后生成秘钥文件</h2><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@fat-ydm01 ~]<span class="comment"># cd /etc/salt/pki/minion/</span></span><br><span class="line">[root@fat-ydm01 minion]<span class="comment"># ll -h</span></span><br><span class="line">-r--------<span class="number"> 1 </span>root root 1.7K Sep <span class="number"> 4 </span>16:19 minion.pem    <span class="comment"># 私钥文件</span></span><br><span class="line">-rw-r--r--<span class="number"> 1 </span>root root <span class="number"> 451 </span>Sep <span class="number"> 4 </span>16:19 minion.pub    <span class="comment"># 公钥文件</span></span><br></pre></td></tr></table></figure><blockquote><p>然后 salt-minion 会把公钥发送给 salt-master</p></blockquote><h2 id="salt-master-启动后生成秘钥文件"><a href="#salt-master-启动后生成秘钥文件" class="headerlink" title="salt-master 启动后生成秘钥文件"></a>salt-master 启动后生成秘钥文件</h2><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster ~]<span class="comment"># cd /etc/salt/pki/master/</span></span><br><span class="line">[root@saltmaster master]<span class="comment"># ll -h</span></span><br><span class="line">[root@jenkins01 master]<span class="comment"># ll -h</span></span><br><span class="line">total 8.0K</span><br><span class="line">-r--------<span class="number"> 1 </span>root root 1.7K Aug<span class="number"> 27 </span>09:03 master.pem    <span class="comment"># 私钥文件</span></span><br><span class="line">-rw-r--r--<span class="number"> 1 </span>root root <span class="number"> 451 </span>Aug<span class="number"> 27 </span>09:03 master.pub    <span class="comment"># 公钥文件</span></span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root  <span class="number"> 23 </span>Sep <span class="number"> 5 </span>15:59 minions</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root   <span class="number"> 6 </span>Aug<span class="number"> 27 </span>09:03 minions_autosign</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root   <span class="number"> 6 </span>Aug<span class="number"> 27 </span>09:03 minions_denied</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root   <span class="number"> 6 </span>Sep <span class="number"> 5 </span>15:49 minions_pre</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root   <span class="number"> 6 </span>Aug<span class="number"> 27 </span>09:03 minions_rejected</span><br></pre></td></tr></table></figure><blockquote><p>授权前，在获取到 minion端后，公钥文件会存放在 minions_pre 目录下</p></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster <span class="literal">master</span>]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── <span class="literal">master</span>.pem</span><br><span class="line">├── <span class="literal">master</span>.pub</span><br><span class="line">├── minions</span><br><span class="line">├── minions_autosign</span><br><span class="line">├── minions_denied</span><br><span class="line">├── minions_pre</span><br><span class="line">│   └── fat-ydm01    <span class="comment"># minion端的公钥文件</span></span><br><span class="line">└── minions_rejected</span><br></pre></td></tr></table></figure><blockquote><p>授权后，minion的公钥文件会被存放在 minions 目录下</p></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster <span class="literal">master</span>]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── <span class="literal">master</span>.pem</span><br><span class="line">├── <span class="literal">master</span>.pub</span><br><span class="line">├── minions</span><br><span class="line">│   └── fat-ydm01    <span class="comment"># minion端的公钥文件</span></span><br><span class="line">├── minions_autosign</span><br><span class="line">├── minions_denied</span><br><span class="line">├── minions_pre</span><br><span class="line">└── minions_rejected</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster master]<span class="comment"># cd minions/</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster minions]<span class="comment"># ll -h</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">451</span> Sep  <span class="number">5</span> <span class="number">15</span><span class="symbol">:</span><span class="number">46</span> fat-ydm01</span><br><span class="line"></span><br><span class="line">[root@saltmaster minions]<span class="comment"># file fat-ydm01</span></span><br><span class="line">fat-<span class="symbol">ydm01:</span> ASCII text</span><br><span class="line"></span><br><span class="line">[root@saltmaster minions]<span class="comment"># cat fat-ydm01</span></span><br><span class="line">-----<span class="keyword">BEGIN</span> PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0DP70JjbCaGB47qsTxn9</span><br><span class="line">I0M46rRv5HEUcEyaRBRehA+DvuZjjV1ud63WxrvMcRXq/M86EURVyjFDcNaZywi3</span><br><span class="line">SO2K70J+wWxD0HDCV0k8SFR/i83n7nPUVmy+PLlSO+ADl8aWogwUw2wZB4JxZ+OS</span><br><span class="line">gWfwvfFZ41yxIlS+Eteb5SkQtRp/OfZrVyEgY6xp4biURsKzP9kFNvOJHW27fcQ9</span><br><span class="line">/XI4JmX2aKYk4LJRVvudkkLzYBW1NeYRv0kMAVGpMm8SiAkIwi+<span class="number">7</span>CJnEWorqAmc<span class="number">0</span></span><br><span class="line">TNLGhtDyhV51cbG5Wbt/vbg6N/NX5BOmErXibEsh7679Wph0mJ1fq5jKjn1fYu/J</span><br><span class="line">rwIDAQAB</span><br><span class="line">-----<span class="keyword">END</span> PUBLIC KEY-----</span><br></pre></td></tr></table></figure><blockquote><p>minion 端也会保存一份 master的公钥</p></blockquote><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@fat-ydm01 ~]<span class="comment"># cd /etc/salt/pki/minion/</span></span><br><span class="line">[root@fat-ydm01 minion]<span class="comment"># ll -h</span></span><br><span class="line">total 12K</span><br><span class="line">-rw-r--r--<span class="number"> 1 </span>root root <span class="number"> 451 </span>Sep <span class="number"> 4 </span>16:19 minion_master.pub    <span class="comment"># master端的公钥文件</span></span><br><span class="line">-r--------<span class="number"> 1 </span>root root 1.7K Sep <span class="number"> 4 </span>16:19 minion.pem</span><br><span class="line">-rw-r--r--<span class="number"> 1 </span>root root <span class="number"> 451 </span>Sep <span class="number"> 4 </span>16:19 minion.pub</span><br></pre></td></tr></table></figure><h2 id="salt-key-命令和参数"><a href="#salt-key-命令和参数" class="headerlink" title="salt-key 命令和参数"></a>salt-key 命令和参数</h2><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式：salt-key 参数 [minion端ID(可以是IP，也可以是主机名) [-y]</span><br><span class="line">-<span class="ruby">h, --help   <span class="comment"># 帮助</span></span></span><br><span class="line"><span class="ruby">-y           <span class="comment"># 该参数可免去证书操作的交互（除非对 minion 端很信任，一般不建议使用）</span></span></span><br></pre></td></tr></table></figure><h3 id="显示所有-public-keys"><a href="#显示所有-public-keys" class="headerlink" title="显示所有 public keys"></a>显示所有 public keys</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span><span class="string">l</span> <span class="string">ARG,</span> <span class="bullet">--list=ARG</span>    <span class="comment"># 显示指定状态的 key（支持正则表达式）</span></span><br><span class="line"><span class="bullet">-</span><span class="string">L,</span> <span class="bullet">--list-all</span>        <span class="comment"># 列出当前所有认证，包括Accepted Keys、Denied Keys、Unaccepted Keys、Rejected Keys</span></span><br><span class="line"><span class="string">Accepted</span> <span class="attr">Keys:</span>        <span class="comment"># 已经接受的key</span></span><br><span class="line"><span class="string">Denied</span> <span class="attr">Keys:</span>          <span class="comment"># 未被允许的key</span></span><br><span class="line"><span class="string">Unaccepted</span> <span class="attr">Keys:</span>      <span class="comment"># 未被接受的key</span></span><br><span class="line"><span class="string">Rejected</span> <span class="attr">Keys:</span>        <span class="comment"># 被拒绝的key</span></span><br><span class="line"></span><br><span class="line"><span class="string">[root@saltmaster</span> <span class="string">~]#</span> <span class="string">salt-key</span> <span class="bullet">-L</span></span><br><span class="line"><span class="string">Accepted</span> <span class="attr">Keys:</span></span><br><span class="line"><span class="string">Denied</span> <span class="attr">Keys:</span></span><br><span class="line"><span class="string">Unaccepted</span> <span class="attr">Keys:</span></span><br><span class="line"><span class="string">fat-ydm01</span></span><br><span class="line"><span class="string">Rejected</span> <span class="attr">Keys:</span></span><br></pre></td></tr></table></figure><h3 id="接受等待认证的-key"><a href="#接受等待认证的-key" class="headerlink" title="接受等待认证的 key"></a>接受等待认证的 key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-a ACCEPT, --accept=ACCEPT    <span class="comment"># 接受指定等待认证的key（支持正则表达式）</span></span><br><span class="line">                              <span class="comment"># 添加某个或某些个未接受(Unaccepted Keys)认证</span></span><br><span class="line">-A, --accept-all              <span class="comment"># 接受所有等待认证的key(Unaccepted Keys)下所有的minion</span></span><br><span class="line">                              <span class="comment"># 添加所有未接受(Unaccepted Keys)认证</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster ~]<span class="comment"># salt-key -a fat-ydm01</span></span><br><span class="line">The following keys are going to be accepted:</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">fat-ydm01</span><br><span class="line">Proceed? [n/Y] y</span><br><span class="line">Key <span class="keyword">for</span> minion fat-ydm01 accepted.</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################################################</span></span><br><span class="line">[root@saltmaster ~]<span class="comment"># salt-key -A -y</span></span><br><span class="line">The following keys are going to be accepted:</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">fat-ydm01</span><br><span class="line">Key <span class="keyword">for</span> minion fat-ydm01 accepted.</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################################################</span></span><br><span class="line">[root@saltmaster ~]<span class="comment"># salt-key -L</span></span><br><span class="line">Accepted Keys:</span><br><span class="line">fat-ydm01</span><br><span class="line">Denied Keys:</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">Rejected Keys:</span><br></pre></td></tr></table></figure><h3 id="拒绝等待认证的-key"><a href="#拒绝等待认证的-key" class="headerlink" title="拒绝等待认证的 key"></a>拒绝等待认证的 key</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">r REJECT, --reject=REJECT    <span class="comment"># 拒绝指定等待认证的key（支持正则表达式）</span></span></span><br><span class="line"><span class="ruby">-R, --reject-all              <span class="comment"># 拒绝所有等待认证的key</span></span></span><br><span class="line"><span class="ruby">--<span class="keyword">include</span>-all                 <span class="comment"># 显示所有状态的key（包含non-pending状态）</span></span></span><br></pre></td></tr></table></figure><h3 id="打印-public-key"><a href="#打印-public-key" class="headerlink" title="打印 public key"></a>打印 public key</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-p PRINT, <span class="params">--print=PRINT</span>    <span class="comment"># 打印指定的 public key（支持正则表达式）</span></span><br><span class="line">-P, <span class="params">--print-all</span>            <span class="comment"># 打印所有的 public key</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster ~]<span class="comment"># salt-key -p "fat-ydm01"</span></span><br><span class="line">Unaccepted Keys:</span><br><span class="line">fat-ydm01:  <span class="params">-----BEGIN</span> PUBLIC KEY<span class="params">-----</span></span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0DP70JjbCaGB47qsTxn9</span><br><span class="line">I0M46rRv5HEUcEyaRBRehA+DvuZjjV1ud63WxrvMcRXq/M86EURVyjFDcNaZywi3</span><br><span class="line">SO2K70J+wWxD0HDCV0k8SFR/i83n7nPUVmy+PLlSO+ADl8aWogwUw2wZB4JxZ+OS</span><br><span class="line">gWfwvfFZ41yxIlS+Eteb5SkQtRp/OfZrVyEgY6xp4biURsKzP9kFNvOJHW27fcQ9</span><br><span class="line"><span class="string">/XI4JmX2aKYk4LJRVvudkkLzYBW1NeYRv0kMAVGpMm8SiAkIwi</span>+7CJnEWorqAmc0</span><br><span class="line">TNLGhtDyhV51cbG5Wbt/vbg6N/NX5BOmErXibEsh7679Wph0mJ1fq5jKjn1fYu/J</span><br><span class="line">rwIDAQAB</span><br><span class="line"><span class="params">-----END</span> PUBLIC KEY<span class="params">-----</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster ~]<span class="comment"># salt-key -P</span></span><br><span class="line">Unaccepted Keys:</span><br><span class="line">fat-ydm01:  <span class="params">-----BEGIN</span> PUBLIC KEY<span class="params">-----</span></span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0DP70JjbCaGB47qsTxn9</span><br><span class="line">I0M46rRv5HEUcEyaRBRehA+DvuZjjV1ud63WxrvMcRXq/M86EURVyjFDcNaZywi3</span><br><span class="line">SO2K70J+wWxD0HDCV0k8SFR/i83n7nPUVmy+PLlSO+ADl8aWogwUw2wZB4JxZ+OS</span><br><span class="line">gWfwvfFZ41yxIlS+Eteb5SkQtRp/OfZrVyEgY6xp4biURsKzP9kFNvOJHW27fcQ9</span><br><span class="line"><span class="string">/XI4JmX2aKYk4LJRVvudkkLzYBW1NeYRv0kMAVGpMm8SiAkIwi</span>+7CJnEWorqAmc0</span><br><span class="line">TNLGhtDyhV51cbG5Wbt/vbg6N/NX5BOmErXibEsh7679Wph0mJ1fq5jKjn1fYu/J</span><br><span class="line">rwIDAQAB</span><br><span class="line"><span class="params">-----END</span> PUBLIC KEY<span class="params">-----</span></span><br></pre></td></tr></table></figure><h3 id="删除已接受的-key"><a href="#删除已接受的-key" class="headerlink" title="删除已接受的 key"></a>删除已接受的 key</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-d <span class="keyword">DELETE</span>, --<span class="keyword">delete</span>=<span class="keyword">DELETE</span>   # 删除某个或某些个已接受(Accepted <span class="keyword">Keys</span>)认证</span><br><span class="line">-D, --<span class="keyword">delete</span>-<span class="keyword">all</span>             # 删除所有已接受(Accepted <span class="keyword">Keys</span>)认证</span><br><span class="line"></span><br><span class="line">[root@saltmaster ~]# salt-<span class="keyword">key</span> -d fat-ydm01 -y</span><br><span class="line">Deleting the following <span class="keyword">keys</span>:</span><br><span class="line">Accepted <span class="keyword">Keys</span>:</span><br><span class="line">fat-ydm01</span><br><span class="line"><span class="keyword">Key</span> <span class="keyword">for</span> minion fat-ydm01 deleted.</span><br></pre></td></tr></table></figure><h3 id="显示-key-的指纹信息"><a href="#显示-key-的指纹信息" class="headerlink" title="显示 key 的指纹信息"></a>显示 key 的指纹信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-f FINGER, --finger=FINGER  <span class="comment"># 显示指定 key 的指纹信息（正则表达式）</span></span><br><span class="line">-F, --finger-all            <span class="comment"># 显示所有 key 的指纹信息</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster ~]<span class="comment"># salt-key -f "fat-ydm01"</span></span><br><span class="line">Unaccepted Keys:</span><br><span class="line">fat-ydm01:  c0:e4:83:48:ef:f7:38:70:c7:1d:47:41:df:9c:03:f0</span><br><span class="line"></span><br><span class="line">[root@saltmaster ~]<span class="comment"># salt-key -F</span></span><br><span class="line">Local Keys:</span><br><span class="line">master.pem:  db:5a:f0:25:13:50:94:b9:e0:61:1d:b9:fe:bc:62:b6</span><br><span class="line">master.pub:  b9:bd:58:90:01:f2:61:7f:03:be:e1:51:f5:0b:4f:08</span><br><span class="line">Unaccepted Keys:</span><br><span class="line">fat-ydm01:  c0:e4:83:48:ef:f7:38:70:c7:1d:47:41:df:9c:03:f0</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################################################</span></span><br><span class="line">[root@saltmaster ~]<span class="comment"># salt-key -f "fat-ydm01"</span></span><br><span class="line">Accepted Keys:</span><br><span class="line">fat-ydm01:  c0:e4:83:48:ef:f7:38:70:c7:1d:47:41:df:9c:03:f0</span><br><span class="line"></span><br><span class="line">[root@saltmaster ~]<span class="comment"># salt-key -F</span></span><br><span class="line">Local Keys:</span><br><span class="line">master.pem:  db:5a:f0:25:13:50:94:b9:e0:61:1d:b9:fe:bc:62:b6</span><br><span class="line">master.pub:  b9:bd:58:90:01:f2:61:7f:03:be:e1:51:f5:0b:4f:08</span><br><span class="line">Accepted Keys:</span><br><span class="line">fat-ydm01:  c0:e4:83:48:ef:f7:38:70:c7:1d:47:41:df:9c:03:f0</span><br></pre></td></tr></table></figure><h3 id="检测主机是否存活"><a href="#检测主机是否存活" class="headerlink" title="检测主机是否存活"></a>检测主机是否存活</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@saltmaster</span> ~]<span class="meta"># salt <span class="string">'fat-ydm01'</span> test.ping</span></span><br><span class="line">fat-ydm01:</span><br><span class="line">    <span class="literal">True</span></span><br></pre></td></tr></table></figure><blockquote><p>我们发送一条消息给一个或所有的 minion，并告诉它们运行 salt 内置的一个模块中的一条命令（也可以说是模块中的一个函数）。该示例中，miniion 返回 true。这个命令能查询有哪些 minion 是存活的。</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SaltStack-认证配置&quot;&gt;&lt;a href=&quot;#SaltStack-认证配置&quot; class=&quot;headerlink&quot; title=&quot;SaltStack 认证配置&quot;&gt;&lt;/a&gt;SaltStack 认证配置&lt;/h1&gt;
    
    </summary>
    
      <category term="SaltStack笔记" scheme="http://www.gmlyo.com/categories/SaltStack%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="SaltStack 认证配置" scheme="http://www.gmlyo.com/tags/SaltStack-%E8%AE%A4%E8%AF%81%E9%85%8D%E7%BD%AE/"/>
    
  </entry>
  
  <entry>
    <title>SaltStack 安装</title>
    <link href="http://www.gmlyo.com/2018/09/04/SaltStack-%E5%AE%89%E8%A3%85/"/>
    <id>http://www.gmlyo.com/2018/09/04/SaltStack-安装/</id>
    <published>2018-09-04T03:15:08.000Z</published>
    <updated>2018-09-04T09:01:08.585Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SaltStack-安装"><a href="#SaltStack-安装" class="headerlink" title="SaltStack 安装"></a>SaltStack 安装</h1><a id="more"></a><h2 id="SaltStack-官网"><a href="#SaltStack-官网" class="headerlink" title="SaltStack 官网"></a>SaltStack 官网</h2><p>官网：<a href="https://repo.saltstack.com/#rhel" target="_blank" rel="noopener">https://repo.saltstack.com/#rhel</a><br>GitHub：<a href="https://github.com/saltstack/salt" target="_blank" rel="noopener">https://github.com/saltstack/salt</a></p><h2 id="最新版本-Pin-to-Latest-Release"><a href="#最新版本-Pin-to-Latest-Release" class="headerlink" title="最新版本(Pin to Latest Release)"></a>最新版本(Pin to Latest Release)</h2><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Redhat/CentOS 7 PY2</span></span><br><span class="line">yum -y install https:<span class="comment">//repo.saltstack.com/yum/redhat/salt-repo-latest-2.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redhat/CentOS 7 PY3</span></span><br><span class="line"><span class="meta"># Redhat Python3 支持要求先安装EPEL</span></span><br><span class="line">yum -y install https:<span class="comment">//repo.saltstack.com/py3/redhat/salt-py3-repo-latest-2.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redhat/CentOS 6 PY2</span></span><br><span class="line">yum -y install https:<span class="comment">//repo.saltstack.com/yum/redhat/salt-repo-latest-2.el6.noarch.rpm</span></span><br></pre></td></tr></table></figure><h2 id="主版本-Pin-to-Major-Version"><a href="#主版本-Pin-to-Major-Version" class="headerlink" title="主版本(Pin to Major Version)"></a>主版本(Pin to Major Version)</h2><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Redhat/CentOS 7 PY2</span></span><br><span class="line">yum -y install https:<span class="comment">//repo.saltstack.com/yum/redhat/salt-repo-2018.3-1.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redhat/CentOS 7 PY3</span></span><br><span class="line">yum -y install https:<span class="comment">//repo.saltstack.com/py3/redhat/salt-py3-repo-2018.3-1.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redhat/CentOS 6 PY2</span></span><br><span class="line">yum -y install https:<span class="comment">//repo.saltstack.com/yum/redhat/salt-repo-2018.3-1.el6.noarch.rpm</span></span><br></pre></td></tr></table></figure><h2 id="次版本-Pin-to-Minor-Release"><a href="#次版本-Pin-to-Minor-Release" class="headerlink" title="次版本(Pin to Minor Release)"></a>次版本(Pin to Minor Release)</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装指定 SaltStack yum仓库文件 和 key文件</span></span><br><span class="line">rpm --import <span class="symbol">https:</span>/<span class="regexp">/repo.saltstack.com/yum</span><span class="regexp">/redhat/</span><span class="number">6</span>/x86_64/archive/<span class="number">2018.3</span>.<span class="number">2</span>/SALTSTACK-GPG-KEY.pub</span><br><span class="line"></span><br><span class="line">cat /etc/yum.repos.d/saltstack.repo</span><br><span class="line">[saltstack-repo]</span><br><span class="line">name=SaltStack repo <span class="keyword">for</span> RHEL/CentOS <span class="variable">$releasever</span></span><br><span class="line">baseurl=<span class="symbol">https:</span>/<span class="regexp">/repo.saltstack.com/yum</span><span class="regexp">/redhat/</span><span class="variable">$releasever</span>/<span class="variable">$basearch</span>/archive/<span class="number">2018.3</span>.<span class="number">2</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=<span class="symbol">https:</span>/<span class="regexp">/repo.saltstack.com/yum</span><span class="regexp">/redhat/</span><span class="variable">$releasever</span>/<span class="variable">$basearch</span>/archive/<span class="number">2018.3</span>.<span class="number">2</span>/SALTSTACK-GPG-KEY.pub</span><br></pre></td></tr></table></figure><h2 id="安装-Salt-组件"><a href="#安装-Salt-组件" class="headerlink" title="安装 Salt 组件"></a>安装 Salt 组件</h2><blockquote><p>获取完以上的仓库源后，执行以下命令，开始安装</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum clean expire-<span class="keyword">cache</span></span><br><span class="line">yum -y <span class="keyword">install</span> <span class="keyword">salt</span>-<span class="keyword">master</span></span><br><span class="line">yum -y <span class="keyword">install</span> <span class="keyword">salt</span>-minion</span><br><span class="line">yum -y <span class="keyword">install</span> <span class="keyword">salt</span>-ssh</span><br><span class="line">yum -y <span class="keyword">install</span> <span class="keyword">salt</span>-syndic</span><br><span class="line">yum -y <span class="keyword">install</span> <span class="keyword">salt</span>-cloud</span><br><span class="line">yum -y <span class="keyword">install</span> <span class="keyword">salt</span>-api</span><br></pre></td></tr></table></figure><h2 id="启停-salt-master-服务"><a href="#启停-salt-master-服务" class="headerlink" title="启停 salt-master 服务"></a>启停 salt-master 服务</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> salt-<span class="literal">master</span></span><br><span class="line">systemctl -l status salt-<span class="literal">master</span></span><br><span class="line">systemctl enable salt-<span class="literal">master</span></span><br><span class="line">systemctl restart salt-<span class="literal">master</span></span><br><span class="line">systemctl <span class="literal">stop</span> salt-<span class="literal">master</span></span><br><span class="line">journalctl -fu salt-<span class="literal">master</span></span><br><span class="line">ps -ef | grep salt-<span class="literal">master</span></span><br></pre></td></tr></table></figure><h2 id="启停-salt-minion-服务"><a href="#启停-salt-minion-服务" class="headerlink" title="启停 salt-minion 服务"></a>启停 salt-minion 服务</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="keyword">start</span> <span class="keyword">salt</span>-minion</span><br><span class="line">systemctl -l <span class="keyword">status</span> <span class="keyword">salt</span>-minion</span><br><span class="line">systemctl <span class="keyword">enable</span> <span class="keyword">salt</span>-minion</span><br><span class="line">systemctl restart <span class="keyword">salt</span>-minion</span><br><span class="line">systemctl <span class="keyword">stop</span> <span class="keyword">salt</span>-minion</span><br><span class="line">journalctl -fu <span class="keyword">salt</span>-minion</span><br><span class="line">ps -ef | grep <span class="keyword">salt</span>-minion</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SaltStack-安装&quot;&gt;&lt;a href=&quot;#SaltStack-安装&quot; class=&quot;headerlink&quot; title=&quot;SaltStack 安装&quot;&gt;&lt;/a&gt;SaltStack 安装&lt;/h1&gt;
    
    </summary>
    
      <category term="SaltStack笔记" scheme="http://www.gmlyo.com/categories/SaltStack%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="SaltStack 安装" scheme="http://www.gmlyo.com/tags/SaltStack-%E5%AE%89%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>Python 可迭代对象与迭代器对象</title>
    <link href="http://www.gmlyo.com/2018/09/03/Python-%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1%E4%B8%8E%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%AF%B9%E8%B1%A1/"/>
    <id>http://www.gmlyo.com/2018/09/03/Python-可迭代对象与迭代器对象/</id>
    <published>2018-09-03T10:07:27.000Z</published>
    <updated>2018-09-03T11:39:02.098Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Python-可迭代对象与迭代器对象"><a href="#Python-可迭代对象与迭代器对象" class="headerlink" title="Python 可迭代对象与迭代器对象"></a>Python 可迭代对象与迭代器对象</h1><a id="more"></a><h3 id="什么是迭代器？"><a href="#什么是迭代器？" class="headerlink" title="什么是迭代器？"></a>什么是迭代器？</h3><blockquote><p>迭代的工具<br>什么是迭代？<br>迭代是一个重复的过程，迭代不是单纯的重复，每一次重复都是基于上一次结果而进行的<br>单纯的重复，并不是迭代</p></blockquote><h3 id="为什么要用迭代器？"><a href="#为什么要用迭代器？" class="headerlink" title="为什么要用迭代器？"></a>为什么要用迭代器？</h3><blockquote><p>找到一种可以不依赖索引的迭代取值方式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; len(i):</span><br><span class="line">    print(l[i])</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>依赖于列表的的索引而进行的<br>索引的取值方式只适用于 字符串，列表，元组 的序列数据类型</p></blockquote><blockquote><p>针对没有索引的数据类型：字典，集合，文件<br>用迭代器，不依赖于索引</p></blockquote><h3 id="怎么用迭代器？"><a href="#怎么用迭代器？" class="headerlink" title="怎么用迭代器？"></a>怎么用迭代器？</h3><blockquote><p>可迭代对象<br>在 Python 中，凡是内置有 <code>__iter__</code> 方法对象，都是可迭代的对象<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">1.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下都是可迭代的对象</span></span><br><span class="line">c = <span class="string">'hello'</span></span><br><span class="line">d = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">e = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">f = &#123;<span class="string">'a'</span>: <span class="number">1</span>&#125;</span><br><span class="line">g = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">f = open(<span class="string">'aa.py'</span>, <span class="string">'rb'</span>)</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>迭代器对象？<br>执行可迭代对象下 <code>__iter__</code> 方法得到的返回值是一个迭代器对象<br>迭代器对象是内置有 <code>__next__</code> 方法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">iter_obj = l.__iter__()</span><br><span class="line">print(iter_obj)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">&lt;list_iterator object at <span class="number">0x00000252754AD080</span>&gt;</span><br></pre></td></tr></table></figure><blockquote><p>如何拿到迭代器？<br>执行可迭代对象下的 <code>__iter__()</code> 方法，就能拿到迭代器对象</p></blockquote><blockquote><p>迭代器对象是内置有 <code>__next__</code> 方法<br>列表类型<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">iter_obj = l.__iter__()</span><br><span class="line"></span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>字典类型<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dic = &#123;<span class="string">'k1'</span>: <span class="number">1</span>, <span class="string">'k2'</span>: <span class="number">2</span>, <span class="string">'k3'</span>: <span class="number">3</span>&#125;</span><br><span class="line">iter_obj = dic.__iter__()</span><br><span class="line"></span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">k1</span><br><span class="line">k2</span><br><span class="line">k3</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>这种取值方式，不依赖于索引</p></blockquote><blockquote><p>迭代器拿到了以后，就可以想<br>可以把所有可迭代对象全都变成迭代器对象，然后再按照迭代器的方式，一点一点取值<br>就完全可以脱离索引对我们取值的一种限制<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dic = &#123;<span class="string">'k1'</span>: <span class="number">1</span>, <span class="string">'k2'</span>: <span class="number">2</span>, <span class="string">'k3'</span>: <span class="number">3</span>&#125;</span><br><span class="line">iter_obj = dic.__iter__()</span><br><span class="line"></span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line">print(iter_obj.__next__())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">k1</span><br><span class="line">k2</span><br><span class="line">k3</span><br><span class="line">StopIteration    <span class="comment"># 结束信号</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>结束信号：<code>StopIteration</code>，一旦这个信号出现后，就应该知道，迭代器里的值已经被取完了<br>按照索引依次排开称为有序，有索引的类型，才是有序的（字符串，列表，元组）<br>字典是无序的，字典取值是按照 key取值的，和顺序没有关系</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim aa.py</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">f4</span><span class="params">()</span>:</span></span><br><span class="line">                <span class="keyword">if</span></span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'aa.py'</span>, <span class="string">'rt'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">iter_obj = f.__iter__()</span><br><span class="line"></span><br><span class="line">print(iter_obj.__next__(), end=<span class="string">''</span>)</span><br><span class="line">print(iter_obj.__next__(), end=<span class="string">''</span>)</span><br><span class="line">print(iter_obj.__next__(), end=<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br></pre></td></tr></table></figure><blockquote><p>对文件来说，特点是什么？<br>也能够按照迭代器的方式，把里面的值，一个个取出来<br>可以完全不依赖于索引，仍然能把一个数据类型里面的值，一次次取出来</p></blockquote><blockquote><p>把字典里的多个值取出来<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dic = &#123;<span class="string">'k1'</span>: <span class="number">1</span>, <span class="string">'k2'</span>: <span class="number">2</span>, <span class="string">'k3'</span>: <span class="number">3</span>&#125;</span><br><span class="line">iter_obj = dic.__iter__()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:   <span class="comment"># 检测有可能抛异常的代码块</span></span><br><span class="line">        print(iter_obj.__next__())</span><br><span class="line">    <span class="keyword">except</span> StopIteration:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">k1</span><br><span class="line">k2</span><br><span class="line">k3</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="for-循环的底层运行机制"><a href="#for-循环的底层运行机制" class="headerlink" title="for 循环的底层运行机制"></a>for 循环的底层运行机制</h3>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Python-可迭代对象与迭代器对象&quot;&gt;&lt;a href=&quot;#Python-可迭代对象与迭代器对象&quot; class=&quot;headerlink&quot; title=&quot;Python 可迭代对象与迭代器对象&quot;&gt;&lt;/a&gt;Python 可迭代对象与迭代器对象&lt;/h1&gt;
    
    </summary>
    
      <category term="Python笔记" scheme="http://www.gmlyo.com/categories/Python%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Python 可迭代对象与迭代器对象" scheme="http://www.gmlyo.com/tags/Python-%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1%E4%B8%8E%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%AF%B9%E8%B1%A1/"/>
    
  </entry>
  
  <entry>
    <title>Python 三元表达式、列表生成式、字典生成式</title>
    <link href="http://www.gmlyo.com/2018/09/03/Python-%E4%B8%89%E5%85%83%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E5%88%97%E8%A1%A8%E7%94%9F%E6%88%90%E5%BC%8F-%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90%E5%BC%8F/"/>
    <id>http://www.gmlyo.com/2018/09/03/Python-三元表达式-列表生成式-字典生成式/</id>
    <published>2018-09-03T02:59:11.000Z</published>
    <updated>2018-09-03T08:29:36.730Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python-三元表达式、列表生成式、字典生成式"><a href="#Python-三元表达式、列表生成式、字典生成式" class="headerlink" title="Python 三元表达式、列表生成式、字典生成式"></a>Python 三元表达式、列表生成式、字典生成式</h2><a id="more"></a><blockquote><p>都是为了写代码写的简介一点儿，不用它们有点问题都没有<br>这四个东西都是为了将多行代码写到一行去，而且还能兼顾一个简洁性的特点</p></blockquote><h3 id="三元表达式"><a href="#三元表达式" class="headerlink" title="三元表达式"></a>三元表达式</h3><blockquote><p>比较两个值最大值最小值的功能<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max2</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &gt; y:</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">res = max2(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>三元表达式 其实就是想用一行把上面这些事情搞定</p></blockquote><p><strong>语法</strong></p><blockquote><p>条件成立时的返回值 if 条件 else 条件不成立时的返回值</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">10</span></span><br><span class="line">y = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">res = x <span class="keyword">if</span> x &gt; y <span class="keyword">else</span> y</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><blockquote><p>条件算一元：<code>if x &gt; y</code><br>条件成立时返回的值算一元：<code>x</code><br>条件不成立时返回的值算一元：<code>else y</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">10</span></span><br><span class="line">y = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">res = <span class="keyword">True</span> <span class="keyword">if</span> x &gt; y <span class="keyword">else</span> <span class="keyword">False</span></span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">1</span></span><br><span class="line">y = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">res = <span class="keyword">True</span> <span class="keyword">if</span> x &gt; y <span class="keyword">else</span> <span class="keyword">False</span></span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"><span class="keyword">False</span></span><br></pre></td></tr></table></figure><h3 id="列表生成式（列表推导式）"><a href="#列表生成式（列表推导式）" class="headerlink" title="列表生成式（列表推导式）"></a>列表生成式（列表推导式）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    l.append(i)</span><br><span class="line"></span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure><p><strong>语法</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[expression <span class="keyword">for</span> item1 <span class="keyword">in</span> iterable1 <span class="keyword">if</span> condition1</span><br><span class="line"><span class="keyword">for</span> item2 <span class="keyword">in</span> iterable2 <span class="keyword">if</span> condition2</span><br><span class="line">...</span><br><span class="line"><span class="keyword">for</span> itemN <span class="keyword">in</span> iterableN <span class="keyword">if</span> conditionN</span><br><span class="line">]</span><br><span class="line">类似于</span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> item1 <span class="keyword">in</span> iterable1:</span><br><span class="line">    <span class="keyword">for</span> item2 <span class="keyword">in</span> iterable2:</span><br><span class="line">        <span class="keyword">if</span> condition2</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">for</span> itemN <span class="keyword">in</span> iterableN:</span><br><span class="line">                <span class="keyword">if</span> conditionN:</span><br><span class="line">                    res.append(expression)</span><br></pre></td></tr></table></figure></p><blockquote><p>列表生成式示例<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l1 = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">print(l1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>获取从4 开始往后的值<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">3</span>:</span><br><span class="line">    l.append(i)</span><br><span class="line"></span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l1 = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i &gt; <span class="number">3</span>]</span><br><span class="line">print(l1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure><p><strong>小练习</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">'zhangsan'</span>, <span class="string">'lisi'</span>, <span class="string">'wangwu'</span>, <span class="string">'zhaoliu'</span>]</span><br><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">    <span class="keyword">if</span> name != <span class="string">'lisi'</span>:</span><br><span class="line">        l.append(name + <span class="string">'py'</span>)</span><br><span class="line"></span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">[<span class="string">'zhangsanpy'</span>, <span class="string">'wangwupy'</span>, <span class="string">'zhaoliupy'</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">'zhangsan_py'</span>, <span class="string">'lisi'</span>, <span class="string">'wangwu_py'</span>, <span class="string">'zhaoliu_py'</span>]</span><br><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">    <span class="keyword">if</span> name.endswith(<span class="string">'sb'</span>):</span><br><span class="line">        l.append(name.upper())</span><br><span class="line"></span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">[<span class="string">'ZHANGSAN_PY'</span>, <span class="string">'WANGWU_PY'</span>, <span class="string">'ZHAOLIU_PY'</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">'zhangsan_py'</span>, <span class="string">'lisi'</span>, <span class="string">'wangwu_py'</span>, <span class="string">'zhaoliu_py'</span>]</span><br><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">    <span class="keyword">if</span> name.endswith(<span class="string">'sb'</span>):</span><br><span class="line">        l.append(name.upper())</span><br><span class="line"></span><br><span class="line">names = l</span><br><span class="line">print(names)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">[<span class="string">'ZHANGSAN_PY'</span>, <span class="string">'WANGWU_PY'</span>, <span class="string">'ZHAOLIU_PY'</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">'zhangsan_py'</span>, <span class="string">'lisi'</span>, <span class="string">'wangwu_py'</span>, <span class="string">'zhaoliu_py'</span>]</span><br><span class="line">names = [name.upper() <span class="keyword">for</span> name <span class="keyword">in</span> names <span class="keyword">if</span> name.endswith(<span class="string">'py'</span>)]</span><br><span class="line">print(names)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">[<span class="string">'ZHANGSAN_PY'</span>, <span class="string">'WANGWU_PY'</span>, <span class="string">'ZHAOLIU_PY'</span>]</span><br></pre></td></tr></table></figure><h3 id="字典生成式"><a href="#字典生成式" class="headerlink" title="字典生成式"></a>字典生成式</h3><blockquote><p>集合生成式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = &#123;i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i &gt; <span class="number">3</span>&#125;</span><br><span class="line">print(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">&#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>把符号 <code>[]</code> 换成 <code>{}</code> 就是字典表达式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = &#123;i:i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i &gt; <span class="number">3</span>&#125;</span><br><span class="line">print(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">&#123;<span class="number">4</span>: <span class="number">4</span>, <span class="number">5</span>: <span class="number">5</span>, <span class="number">6</span>: <span class="number">6</span>, <span class="number">7</span>: <span class="number">7</span>, <span class="number">8</span>: <span class="number">8</span>, <span class="number">9</span>: <span class="number">9</span>&#125;</span><br></pre></td></tr></table></figure></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">userinfo = [(<span class="string">'egon'</span>, <span class="string">'123'</span>), (<span class="string">'alex'</span>. <span class="string">'456'</span>), (<span class="string">'wxx'</span>, <span class="string">'679'</span>)]</span><br><span class="line">dic = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> userinfo&#125;</span><br><span class="line">print(dic)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">&#123;<span class="string">'egon'</span>: <span class="string">'123'</span>, <span class="string">'alex'</span>, <span class="string">'456'</span>, <span class="string">'wxx'</span>: <span class="string">'679'</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>小练习</strong></p><blockquote><p>将列表转换成字典</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">info = [</span><br><span class="line">    [<span class="string">'name'</span>, <span class="string">'egon'</span>],</span><br><span class="line">    (<span class="string">'age'</span>, <span class="number">18</span>),</span><br><span class="line">    [<span class="string">'sex'</span>, <span class="string">'male'</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">d = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> info:</span><br><span class="line">    print(item)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">[<span class="string">'name'</span>, <span class="string">'egon'</span>]</span><br><span class="line">(<span class="string">'age'</span>, <span class="number">18</span>)</span><br><span class="line">[<span class="string">'sex'</span>, <span class="string">'male'</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">info = [</span><br><span class="line">    [<span class="string">'name'</span>, <span class="string">'egon'</span>],</span><br><span class="line">    (<span class="string">'age'</span>, <span class="number">18</span>),</span><br><span class="line">    [<span class="string">'sex'</span>, <span class="string">'male'</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">d = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> info:</span><br><span class="line">    print(item[<span class="number">0</span>], item[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">name egon</span><br><span class="line">age <span class="number">18</span></span><br><span class="line">sex male</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">info = [</span><br><span class="line">    [<span class="string">'name'</span>, <span class="string">'egon'</span>],</span><br><span class="line">    (<span class="string">'age'</span>, <span class="number">18</span>),</span><br><span class="line">    [<span class="string">'sex'</span>, <span class="string">'male'</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">d = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> info:</span><br><span class="line">    d[item[<span class="number">0</span>]] = item[<span class="number">1</span>]</span><br><span class="line">print(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'egon'</span>, <span class="string">'age'</span>: <span class="number">18</span>, <span class="string">'sex'</span>: <span class="string">'male'</span>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">info = [</span><br><span class="line">    [<span class="string">'name'</span>, <span class="string">'egon'</span>],</span><br><span class="line">    (<span class="string">'age'</span>, <span class="number">18</span>),</span><br><span class="line">    [<span class="string">'sex'</span>, <span class="string">'male'</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">d = &#123;item[<span class="number">0</span>]: item[<span class="number">1</span>] <span class="keyword">for</span> item <span class="keyword">in</span> info&#125;</span><br><span class="line">print(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'egon'</span>, <span class="string">'age'</span>: <span class="number">18</span>, <span class="string">'sex'</span>: <span class="string">'male'</span>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>把 key 变成大写</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'egon'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="string">'sex'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">d = &#123;k.upper():v <span class="keyword">for</span> k,v <span class="keyword">in</span> d.items()&#125;</span><br><span class="line">print(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">&#123;<span class="string">'NAME'</span>: <span class="string">'egon'</span>, <span class="string">'AGE'</span>: <span class="number">18</span>, <span class="string">'SEX'</span>: <span class="string">'male'</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="生成器表达式"><a href="#生成器表达式" class="headerlink" title="生成器表达式"></a>生成器表达式</h3><blockquote><p>把列表推导式的 <code>[]</code> 换成 <code>()</code> 就是生成器表达式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g = (i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>))</span><br><span class="line">print(g)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">&lt;generator object &lt;genexpr&gt; at <span class="number">0x000001719E5E3EB8</span>&gt;</span><br></pre></td></tr></table></figure></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">g = (i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>))</span><br><span class="line">print(next(g))</span><br><span class="line">print(next(g))</span><br><span class="line">print(next(g))</span><br><span class="line">print(next(g))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><blockquote><p>示例：生一筐鸡蛋变成给你一只老母鸡，用的时候就下蛋，这也是生成器的特性<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>chicken = (<span class="string">'鸡蛋%s'</span> % <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chicken</span><br><span class="line">&lt;generator object &lt;genexpr&gt; at <span class="number">0x10143f200</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(chicken)</span><br><span class="line"><span class="string">'鸡蛋0'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(chicken)    <span class="comment"># 因 chicken 可迭代，因而可以转成列表</span></span><br><span class="line">[<span class="string">'鸡蛋1'</span>, <span class="string">'鸡蛋2'</span>, <span class="string">'鸡蛋3'</span>, <span class="string">'鸡蛋4'</span>,]</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>优点：省内存，一次只产生一个值在内存中</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">chicken = (<span class="string">'egg%s'</span> % <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>))</span><br><span class="line">print(next(chicken))</span><br><span class="line">print(next(chicken))</span><br><span class="line">print(next(chicken))</span><br><span class="line">print(next(chicken))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">egg0</span><br><span class="line">egg1</span><br><span class="line">egg2</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Python-三元表达式、列表生成式、字典生成式&quot;&gt;&lt;a href=&quot;#Python-三元表达式、列表生成式、字典生成式&quot; class=&quot;headerlink&quot; title=&quot;Python 三元表达式、列表生成式、字典生成式&quot;&gt;&lt;/a&gt;Python 三元表达式、列表生成式、字典生成式&lt;/h2&gt;
    
    </summary>
    
      <category term="Python笔记" scheme="http://www.gmlyo.com/categories/Python%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Python 三元表达式、列表生成式、字典生成式" scheme="http://www.gmlyo.com/tags/Python-%E4%B8%89%E5%85%83%E8%A1%A8%E8%BE%BE%E5%BC%8F%E3%80%81%E5%88%97%E8%A1%A8%E7%94%9F%E6%88%90%E5%BC%8F%E3%80%81%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Docker 资源汇总</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-%E8%B5%84%E6%BA%90%E6%B1%87%E6%80%BB/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-资源汇总/</id>
    <published>2018-09-01T10:26:21.000Z</published>
    <updated>2018-09-01T10:31:28.442Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-资源汇总"><a href="#Docker-资源汇总" class="headerlink" title="Docker 资源汇总"></a>Docker 资源汇总</h1><a id="more"></a><h3 id="Docker官方英文资源"><a href="#Docker官方英文资源" class="headerlink" title="Docker官方英文资源"></a>Docker官方英文资源</h3><p>Docker官网：<a href="http://www.docker.com/" target="_blank" rel="noopener">http://www.docker.com</a><br>Docker windows入门：<a href="https://docs.docker.com/windows/" target="_blank" rel="noopener">https://docs.docker.com/windows/</a><br>Docker Linux 入门：<a href="https://docs.docker.com/linux/" target="_blank" rel="noopener">https://docs.docker.com/linux/</a><br>Docker mac 入门：<a href="https://docs.docker.com/mac/" target="_blank" rel="noopener">https://docs.docker.com/mac/</a><br>Docker 用户指引：<a href="https://docs.docker.com/engine/userguide/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/</a><br>Docker 官方博客：<a href="http://blog.docker.com/" target="_blank" rel="noopener">http://blog.docker.com/</a><br>Docker Hub: <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a><br>Docker开源： <a href="https://www.docker.com/open-source" target="_blank" rel="noopener">https://www.docker.com/open-source</a></p><h3 id="Docker中文资源"><a href="#Docker中文资源" class="headerlink" title="Docker中文资源"></a>Docker中文资源</h3><p>Docker中文网站：<a href="https://www.docker-cn.com/" target="_blank" rel="noopener">https://www.docker-cn.com/</a><br>Docker安装手册：<a href="https://docs.docker-cn.com/engine/installation/" target="_blank" rel="noopener">https://docs.docker-cn.com/engine/installation/</a></p><h3 id="Docker-国内镜像"><a href="#Docker-国内镜像" class="headerlink" title="Docker 国内镜像"></a>Docker 国内镜像</h3><p>网易加速器：<a href="http://hub-mirror.c.163.com" target="_blank" rel="noopener">http://hub-mirror.c.163.com</a><br>官方中国加速器：<a href="https://registry.docker-cn.com" target="_blank" rel="noopener">https://registry.docker-cn.com</a><br>ustc的镜像：<a href="https://docker.mirrors.ustc.edu.cn" target="_blank" rel="noopener">https://docker.mirrors.ustc.edu.cn</a><br>daocloud：<a href="https://www.daocloud.io/mirror#accelerator-doc（注册后使用）" target="_blank" rel="noopener">https://www.daocloud.io/mirror#accelerator-doc（注册后使用）</a></p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-resources.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-resources.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-资源汇总&quot;&gt;&lt;a href=&quot;#Docker-资源汇总&quot; class=&quot;headerlink&quot; title=&quot;Docker 资源汇总&quot;&gt;&lt;/a&gt;Docker 资源汇总&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker 资源汇总" scheme="http://www.gmlyo.com/tags/Docker-%E8%B5%84%E6%BA%90%E6%B1%87%E6%80%BB/"/>
    
  </entry>
  
  <entry>
    <title>Docker tag 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-tag-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-tag-命令/</id>
    <published>2018-09-01T09:58:14.000Z</published>
    <updated>2018-09-01T09:58:46.496Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-tag-命令"><a href="#Docker-tag-命令" class="headerlink" title="Docker tag 命令"></a>Docker tag 命令</h1><a id="more"></a><p><strong>docker tag :</strong> 标记本地镜像，将其归入某一仓库。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag [<span class="string">OPTIONS</span>] IMAGE[<span class="string">:TAG</span>] [<span class="string">REGISTRYHOST/</span>][<span class="symbol">USERNAME/</span>]NAME[:TAG]</span><br></pre></td></tr></table></figure><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>将镜像 ubuntu:15.10 标记为 runoob/ubuntu:v3 镜像。</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhsot ~] docker <span class="keyword">tag</span> <span class="title">ubuntu</span>:<span class="number">15.10</span> runoob/ubuntu:v3</span><br><span class="line">[root@localhsot ~] docker images runoob/ubuntu:v3</span><br><span class="line">REPOSITORY          <span class="keyword">TAG</span>                 <span class="title">IMAGE</span> ID            CREATED             SIZE</span><br><span class="line">runoob/ubuntu       v3                  <span class="number">4</span>e3b13c8a266        <span class="number">3</span> months ago        <span class="number">136.3</span> MB</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-tag-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-tag-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-tag-命令&quot;&gt;&lt;a href=&quot;#Docker-tag-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker tag 命令&quot;&gt;&lt;/a&gt;Docker tag 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker tag 命令" scheme="http://www.gmlyo.com/tags/Docker-tag-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker search 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-search-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-search-命令/</id>
    <published>2018-09-01T09:56:02.000Z</published>
    <updated>2018-09-01T09:56:24.774Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-search-命令"><a href="#Docker-search-命令" class="headerlink" title="Docker search 命令"></a>Docker search 命令</h1><a id="more"></a><p><strong>docker search :</strong> 从 Docker Hub 查找镜像</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search <span class="string">[OPTIONS]</span> TERM</span><br></pre></td></tr></table></figure><p>OPTIONS 说明：</p><ul><li><strong>–automated :</strong> 只列出 automated build 类型的镜像；</li><li><strong>–no-trunc :</strong> 显示完整的镜像描述；</li><li><strong>-s :</strong> 列出收藏数不小于指定值的镜像。</li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>从 Docker Hub 查找所有镜像名包含 java，并且收藏数大于 10 的镜像</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~] docker search -s <span class="number">10</span> java</span><br><span class="line">NAME                  DESCRIPTION                           STARS   OFFICIAL   AUTOMATED</span><br><span class="line">java                  Java is a concurrent, class-based...   <span class="number">1037</span>    [OK]       </span><br><span class="line">anapsix/alpine-java   Oracle Java <span class="number">8</span> (and <span class="number">7</span>) with GLIBC ...   <span class="number">115</span>                [OK]</span><br><span class="line">develar/java                                                 <span class="number">46</span>                 [OK]</span><br><span class="line">isuper/java-oracle    This repository contains all java...   <span class="number">38</span>                 [OK]</span><br><span class="line">lwieske/java<span class="number">-8</span>        Oracle Java <span class="number">8</span> Container - Full + ...   <span class="number">27</span>                 [OK]</span><br><span class="line">nimmis/java-centos    This is docker images of CentOS <span class="number">7.</span>..   <span class="number">13</span>                 [OK]</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-search-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-search-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-search-命令&quot;&gt;&lt;a href=&quot;#Docker-search-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker search 命令&quot;&gt;&lt;/a&gt;Docker search 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker search 命令" scheme="http://www.gmlyo.com/tags/Docker-search-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker push 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-push-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-push-命令/</id>
    <published>2018-09-01T09:54:02.000Z</published>
    <updated>2018-09-01T09:54:24.363Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-push-命令"><a href="#Docker-push-命令" class="headerlink" title="Docker push 命令"></a>Docker push 命令</h1><a id="more"></a><p><strong>docker push :</strong> 将本地的镜像上传到镜像仓库，要先登陆到镜像仓库。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push <span class="string">[OPTIONS]</span> NAME<span class="string">[:TAG]</span></span><br></pre></td></tr></table></figure><p>OPTIONS 说明：</p><ul><li><strong>–disable-content-trust :</strong> 忽略镜像的校验，默认开启。</li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>上传本地镜像 <code>myapache:v1</code> 到镜像仓库中。</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span> <span class="keyword">push </span>myapache:<span class="built_in">v1</span></span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-push-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-push-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-push-命令&quot;&gt;&lt;a href=&quot;#Docker-push-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker push 命令&quot;&gt;&lt;/a&gt;Docker push 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker push 命令" scheme="http://www.gmlyo.com/tags/Docker-push-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker pull 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-pull-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-pull-命令/</id>
    <published>2018-09-01T09:52:02.000Z</published>
    <updated>2018-09-01T09:52:51.904Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-pull-命令"><a href="#Docker-pull-命令" class="headerlink" title="Docker pull 命令"></a>Docker pull 命令</h1><a id="more"></a><p><strong>docker pull :</strong> 从镜像仓库中拉取或者更新指定镜像</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull [OPTIONS] NAME[<span class="symbol">:TAG|</span><span class="variable">@DIGEST</span>]</span><br></pre></td></tr></table></figure><p>OPTIONS 说明：</p><ul><li><strong>-a :</strong> 拉取所有 tagged 镜像</li><li><strong>–disable-content-trust :</strong> 忽略镜像的校验，默认开启</li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>从 Docker Hub 下载 java 最新版镜像。</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker pull java</span></span><br></pre></td></tr></table></figure><p>从 Docker Hub 下载 REPOSITORY 为 java 的所有镜像。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull -<span class="selector-tag">a</span> java</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-pull-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-pull-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-pull-命令&quot;&gt;&lt;a href=&quot;#Docker-pull-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker pull 命令&quot;&gt;&lt;/a&gt;Docker pull 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker pull 命令" scheme="http://www.gmlyo.com/tags/Docker-pull-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker version 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-version-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-version-命令/</id>
    <published>2018-09-01T09:49:02.000Z</published>
    <updated>2018-09-01T09:49:24.818Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-version-命令"><a href="#Docker-version-命令" class="headerlink" title="Docker version 命令"></a>Docker version 命令</h1><a id="more"></a><p><strong>docker version :</strong> 显示 Docker 版本信息。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version <span class="string">[OPTIONS]</span></span><br></pre></td></tr></table></figure><p>OPTIONS 说明：</p><ul><li><strong>-f :</strong> 指定返回值的模板文件。</li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>显示 Docker 版本信息。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">version</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"><span class="attr"> Version:</span>      <span class="number">1.8</span><span class="number">.2</span></span><br><span class="line"> <span class="string">API</span> <span class="attr">version:</span>  <span class="number">1.20</span></span><br><span class="line"> <span class="string">Go</span> <span class="attr">version:</span>   <span class="string">go1.4.2</span></span><br><span class="line"> <span class="string">Git</span> <span class="attr">commit:</span>   <span class="number">0</span><span class="string">a8c2e3</span></span><br><span class="line"><span class="attr"> Built:</span>        <span class="string">Thu</span> <span class="string">Sep</span> <span class="number">10</span> <span class="number">19</span><span class="string">:19:00</span> <span class="string">UTC</span> <span class="number">2015</span></span><br><span class="line"> <span class="string">OS/Arch:</span>      <span class="string">linux/amd64</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"><span class="attr"> Version:</span>      <span class="number">1.8</span><span class="number">.2</span></span><br><span class="line"> <span class="string">API</span> <span class="attr">version:</span>  <span class="number">1.20</span></span><br><span class="line"> <span class="string">Go</span> <span class="attr">version:</span>   <span class="string">go1.4.2</span></span><br><span class="line"> <span class="string">Git</span> <span class="attr">commit:</span>   <span class="number">0</span><span class="string">a8c2e3</span></span><br><span class="line"><span class="attr"> Built:</span>        <span class="string">Thu</span> <span class="string">Sep</span> <span class="number">10</span> <span class="number">19</span><span class="string">:19:00</span> <span class="string">UTC</span> <span class="number">2015</span></span><br><span class="line"> <span class="string">OS/Arch:</span>      <span class="string">linux/amd64</span></span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-version-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-version-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-version-命令&quot;&gt;&lt;a href=&quot;#Docker-version-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker version 命令&quot;&gt;&lt;/a&gt;Docker version 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker version 命令" scheme="http://www.gmlyo.com/tags/Docker-version-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker info 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-info-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-info-命令/</id>
    <published>2018-09-01T09:45:51.000Z</published>
    <updated>2018-09-01T09:46:29.154Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-info-命令"><a href="#Docker-info-命令" class="headerlink" title="Docker info 命令"></a>Docker info 命令</h1><a id="more"></a><p><strong>docker info :</strong> 显示 Docker 系统信息，包括镜像和容器数。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> <span class="literal">info</span> [OPTIONS]</span><br></pre></td></tr></table></figure><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>查看 docker 系统信息。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br><span class="line"><span class="string">Containers:</span> <span class="number">12</span></span><br><span class="line"><span class="string">Images:</span> <span class="number">41</span></span><br><span class="line">Storage <span class="string">Driver:</span> aufs</span><br><span class="line"> Root <span class="string">Dir:</span> <span class="regexp">/var/</span>lib<span class="regexp">/docker/</span>aufs</span><br><span class="line"> Backing <span class="string">Filesystem:</span> extfs</span><br><span class="line"><span class="symbol"> Dirs:</span> <span class="number">66</span></span><br><span class="line"> Dirperm1 <span class="string">Supported:</span> <span class="literal">false</span></span><br><span class="line">Execution <span class="string">Driver:</span> native<span class="number">-0.2</span></span><br><span class="line">Logging <span class="string">Driver:</span> json-file</span><br><span class="line">Kernel <span class="string">Version:</span> <span class="number">3.13</span><span class="number">.0</span><span class="number">-32</span>-generic</span><br><span class="line">Operating <span class="string">System:</span> Ubuntu <span class="number">14.04</span><span class="number">.1</span> LTS</span><br><span class="line"><span class="string">CPUs:</span> <span class="number">1</span></span><br><span class="line">Total <span class="string">Memory:</span> <span class="number">1.954</span> GiB</span><br><span class="line"><span class="string">Name:</span> iZ23mtq8bs1Z</span><br><span class="line"><span class="string">ID:</span> <span class="string">M5N4:</span><span class="string">K6WN:</span><span class="string">PUNC:</span><span class="number">73</span><span class="string">ZN:</span><span class="string">AONJ:</span><span class="string">AUHL:</span><span class="string">KSYH:</span><span class="number">2</span><span class="string">JPI:</span><span class="string">CH3K:</span><span class="string">O4MK:</span><span class="number">6</span><span class="string">OCX:</span><span class="number">5</span>OYW</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-info-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-info-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-info-命令&quot;&gt;&lt;a href=&quot;#Docker-info-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker info 命令&quot;&gt;&lt;/a&gt;Docker info 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker info 命令" scheme="http://www.gmlyo.com/tags/Docker-info-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker import 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-import-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-import-命令/</id>
    <published>2018-09-01T09:42:58.000Z</published>
    <updated>2018-09-01T09:43:17.437Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-import-命令"><a href="#Docker-import-命令" class="headerlink" title="Docker import 命令"></a>Docker import 命令</h1><a id="more"></a><p><strong>docker import :</strong> 从归档文件中创建镜像。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">import</span> [<span class="keyword">OPTIONS</span>] <span class="keyword">file</span>|URL|- [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure><p>OPTIONS 说明：</p><ul><li><strong>-c :</strong> 应用 docker 指令创建镜像；</li><li><strong>-m :</strong> 提交时的说明文字；</li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>从镜像归档文件 my_ubuntu_v3.tar 创建镜像，命名为 runoob/ubuntu:v4</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@localhost</span> ~] docker <span class="keyword">import</span> my_ubuntu_v3.tar runoob/<span class="string">ubuntu:</span>v4  </span><br><span class="line"><span class="string">sha256:</span><span class="number">63</span>ce4a6d6bc3fabb95dbd6c561404a309b7bdfc4e21c1d59fe9fe4299cbfea39</span><br><span class="line">[root<span class="meta">@localhost</span> ~] docker images runoob/<span class="string">ubuntu:</span>v4</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">runoob/ubuntu       v4                  <span class="number">63</span>ce4a6d6bc3        <span class="number">20</span> seconds ago      <span class="number">142.1</span> MB</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-import-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-import-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-import-命令&quot;&gt;&lt;a href=&quot;#Docker-import-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker import 命令&quot;&gt;&lt;/a&gt;Docker import 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker import 命令" scheme="http://www.gmlyo.com/tags/Docker-import-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker save 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-save-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-save-命令/</id>
    <published>2018-09-01T09:40:00.000Z</published>
    <updated>2018-09-01T09:42:22.795Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-save-命令"><a href="#Docker-save-命令" class="headerlink" title="Docker save 命令"></a>Docker save 命令</h1><a id="more"></a><p><strong>docker save :</strong> 将指定镜像保存成 tar 归档文件。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save <span class="string">[OPTIONS]</span> IMAGE <span class="string">[IMAGE...]</span></span><br></pre></td></tr></table></figure><p>OPTIONS 说明：</p><ul><li><strong>-o :</strong> 输出到的文件。</li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>将镜像 runoob/ubuntu:v3 生成 my_ubuntu_v3.tar 文档</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span> <span class="selector-tag">docker</span> <span class="selector-tag">save</span> <span class="selector-tag">-o</span> <span class="selector-tag">my_ubuntu_v3</span><span class="selector-class">.tar</span> <span class="selector-tag">runoob</span>/<span class="selector-tag">ubuntu</span><span class="selector-pseudo">:v3</span></span><br><span class="line"><span class="selector-attr">[root@localhost ~]</span> <span class="selector-tag">ll</span> <span class="selector-tag">my_ubuntu_v3</span><span class="selector-class">.tar</span></span><br><span class="line"><span class="selector-tag">-rw-------</span> <span class="selector-tag">1</span> <span class="selector-tag">runoob</span> <span class="selector-tag">runoob</span> <span class="selector-tag">142102016</span> <span class="selector-tag">Jul</span> <span class="selector-tag">11</span> <span class="selector-tag">01</span><span class="selector-pseudo">:37</span> <span class="selector-tag">my_ubuntu_v3</span><span class="selector-class">.ta</span></span><br></pre></td></tr></table></figure><h3 id="Docker-容器导入导出有两种方法"><a href="#Docker-容器导入导出有两种方法" class="headerlink" title="Docker 容器导入导出有两种方法"></a>Docker 容器导入导出有两种方法</h3><p>一种是使用 save 和 load 命令<br>使用例子如下：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">save</span> ubuntu:<span class="keyword">load</span> &gt; /root/ubuntu.tar</span><br><span class="line">docker <span class="keyword">load</span> &lt; ubuntu.tar</span><br></pre></td></tr></table></figure><p>一种是使用 export 和 import 命令<br>使用例子如下：</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">docker</span> <span class="keyword">export</span> <span class="number">98</span>ca36 &gt; ubuntu.tar</span><br><span class="line"><span class="title">cat</span> ubuntu.tar | sudo docker <span class="keyword">import</span> - ubuntu:<span class="keyword">import</span></span><br></pre></td></tr></table></figure><p>需要注意两种方法不可混用。</p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-save-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-save-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-save-命令&quot;&gt;&lt;a href=&quot;#Docker-save-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker save 命令&quot;&gt;&lt;/a&gt;Docker save 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker save 命令" scheme="http://www.gmlyo.com/tags/Docker-save-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker build 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-build-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-build-命令/</id>
    <published>2018-09-01T09:32:04.000Z</published>
    <updated>2018-09-01T09:32:41.862Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-build-命令"><a href="#Docker-build-命令" class="headerlink" title="Docker build 命令"></a>Docker build 命令</h1><a id="more"></a><p><strong>docker build </strong> 命令用于使用 Dockerfile 创建镜像。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build [OPTIONS] PATH |<span class="string"> URL </span>|<span class="string"> -</span></span><br></pre></td></tr></table></figure><p>OPTIONS说明：</p><ul><li><strong>–build-arg=[] :</strong> 设置镜像创建时的变量；</li><li><strong>–cpu-shares :</strong> 设置 CPU 使用权重；</li><li><strong>–cpu-period :</strong> 限制 CPU CFS周期；</li><li><strong>–cpu-quota :</strong> 限制 CPU CFS配额；</li><li><strong>–cpuset-cpus :</strong> 指定使用的CPU id；</li><li><strong>–cpuset-mems :</strong> 指定使用的内存 id；</li><li><strong>–disable-content-trust :</strong> 忽略校验，默认开启；</li><li><strong>-f :</strong> 指定要使用的 Dockerfile 路径；</li><li><strong>–force-rm :</strong> 设置镜像过程中删除中间容器；</li><li><strong>–isolation :</strong> 使用容器隔离技术；</li><li><strong>–label=[] :</strong> 设置镜像使用的元数据；</li><li><strong>-m :</strong> 设置内存最大值；</li><li><strong>–memory-swap :</strong> 设置 swap 的最大值为 内存+swap，”-1” 表示不限 swap；</li><li><strong>–no-cache :</strong> 创建镜像的过程不使用缓存；</li><li><strong>–pull :</strong> 尝试去更新镜像的新版本；</li><li><strong>–quiet, -q :</strong> 安静模式，成功后只输出镜像 ID；</li><li><strong>–rm :</strong> 设置镜像成功后删除中间容器；</li><li><strong>–shm-size :</strong> 设置 /dev/shm 的大小，默认值是 64M；</li><li><strong>–ulimit :</strong> Ulimit 配置。</li><li><strong>–tag, -t:</strong> 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。</li><li><strong>–network:</strong> 默认 default。在构建期间设置RUN指令的网络模式</li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>使用当前目录的 Dockerfile 创建镜像，标签为 runoob/ubuntu:v1。</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-t runoob/ubuntu:<span class="built_in">v1</span> .</span><br></pre></td></tr></table></figure><p>使用 URL <strong>github.com/creack/docker-firefox</strong> 的 Dockerfile 创建镜像。</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span> <span class="keyword">build </span>github.com/creack/docker-firefox</span><br></pre></td></tr></table></figure><p>也可以通过 -f Dockerfile 文件的位置：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">build</span> -f /<span class="keyword">path</span>/<span class="keyword">to</span>/a/Dockerfile .</span><br></pre></td></tr></table></figure><p>在 Docker 守护进程执行 Dockerfile 中的指令前，首先会对 Dockerfile 进行语法检查，有语法错误时会返回：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t test/myapp .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line"><span class="keyword">Error </span>response from daemon: Unknown instruction: RUNCMD</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-build-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-build-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-build-命令&quot;&gt;&lt;a href=&quot;#Docker-build-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker build 命令&quot;&gt;&lt;/a&gt;Docker build 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker build 命令" scheme="http://www.gmlyo.com/tags/Docker-build-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker rmi 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-rmi-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-rmi-命令/</id>
    <published>2018-09-01T09:27:30.000Z</published>
    <updated>2018-09-01T09:28:46.334Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-rmi-命令"><a href="#Docker-rmi-命令" class="headerlink" title="Docker rmi 命令"></a>Docker rmi 命令</h1><a id="more"></a><p><strong>docker rmi :</strong> 删除本地一个或多个镜像。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi <span class="string">[OPTIONS]</span> IMAGE <span class="string">[IMAGE...]</span></span><br></pre></td></tr></table></figure><p>OPTIONS 说明：</p><ul><li><strong>-f :</strong> 强制删除；</li><li><strong>–no-prune :</strong> 不移除该镜像的过程镜像，默认移除；</li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>强制删除本地镜像 runoob/ubuntu:v4。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@localhost</span> ~] docker rmi -f runoob/<span class="string">ubuntu:</span>v4</span><br><span class="line"><span class="string">Untagged:</span> runoob/<span class="string">ubuntu:</span>v4</span><br><span class="line"><span class="string">Deleted:</span> <span class="string">sha256:</span><span class="number">1</span>c06aa18edee44230f93a90a7d88139235de12cd4c089d41eed8419b503072be</span><br><span class="line"><span class="string">Deleted:</span> <span class="string">sha256:</span><span class="number">85</span>feb446e89a28d58ee7d80ea5ce367eebb7cec70f0ec18aa4faa874cbd97c73</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-rmi-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-rmi-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-rmi-命令&quot;&gt;&lt;a href=&quot;#Docker-rmi-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker rmi 命令&quot;&gt;&lt;/a&gt;Docker rmi 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker rmi 命令" scheme="http://www.gmlyo.com/tags/Docker-rmi-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Docker images 命令</title>
    <link href="http://www.gmlyo.com/2018/09/01/Docker-images-%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.gmlyo.com/2018/09/01/Docker-images-命令/</id>
    <published>2018-09-01T09:25:10.000Z</published>
    <updated>2018-09-01T09:26:09.582Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-images-命令"><a href="#Docker-images-命令" class="headerlink" title="Docker images 命令"></a>Docker images 命令</h1><a id="more"></a><p><strong>docker images :</strong> 列出本地镜像。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images <span class="comment">[OPTIONS]</span> <span class="comment">[REPOSITORY<span class="comment">[:TAG]</span>]</span></span><br></pre></td></tr></table></figure><p>OPTIONS 说明：</p><ul><li><strong>-a :</strong> 列出本地所有的镜像（含中间映像层，默认情况下，过滤掉中间映像层）；</li><li><strong>–digests :</strong> 显示镜像的摘要信息；</li><li><strong>-f :</strong> 显示满足条件的镜像；</li><li><strong>–format :</strong> 指定返回值的模板文件；</li><li><strong>–no-trunc :</strong> 显示完整的镜像信息；</li><li><strong>-q :</strong> 只显示镜像ID。</li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>查看本地镜像列表。</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~] docker images</span><br><span class="line">REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mymysql                 v1                  <span class="number">37</span>af1236adef        <span class="number">5</span> minutes ago       <span class="number">329</span> MB</span><br><span class="line">runoob/ubuntu           v4                  <span class="number">1</span>c06aa18edee        <span class="number">2</span> days ago          <span class="number">142.1</span> MB</span><br><span class="line">&lt;none&gt;                  &lt;none&gt;              <span class="number">5</span>c6e1090e771        <span class="number">2</span> days ago          <span class="number">165.9</span> MB</span><br><span class="line">httpd                   latest              ed38aaffef30        <span class="number">11</span> days ago         <span class="number">195.1</span> MB</span><br><span class="line">alpine                  latest              <span class="number">4e38</span>e38c8ce0        <span class="number">2</span> weeks ago         <span class="number">4.799</span> MB</span><br><span class="line">mongo                   <span class="number">3.2</span>                 <span class="number">282</span>fd552add6        <span class="number">3</span> weeks ago         <span class="number">336.1</span> MB</span><br><span class="line">redis                   latest              <span class="number">4465e4</span>bcad80        <span class="number">3</span> weeks ago         <span class="number">185.7</span> MB</span><br><span class="line">php                     <span class="number">5.6</span>-fpm             <span class="number">025041</span>cd3aa5        <span class="number">3</span> weeks ago         <span class="number">456.3</span> MB</span><br><span class="line">python                  <span class="number">3.5</span>                 <span class="number">045767</span>ddf24a        <span class="number">3</span> weeks ago         <span class="number">684.1</span> MB</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>列出本地镜像中 REPOSITORY 为 ubuntu 的镜像列表。</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~] docker images ubuntu</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">ubuntu              <span class="number">14.04</span>               <span class="number">90</span>d5884b1ee0        <span class="number">9</span> weeks ago         <span class="number">188</span> MB</span><br><span class="line">ubuntu              <span class="number">15.10</span>               <span class="number">4e3</span>b13c8a266        <span class="number">3</span> months ago        <span class="number">136.3</span> MB</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://www.runoob.com/docker/docker-images-command.html" target="_blank" rel="noopener">http://www.runoob.com/docker/docker-images-command.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Docker-images-命令&quot;&gt;&lt;a href=&quot;#Docker-images-命令&quot; class=&quot;headerlink&quot; title=&quot;Docker images 命令&quot;&gt;&lt;/a&gt;Docker images 命令&lt;/h1&gt;
    
    </summary>
    
      <category term="Docker笔记" scheme="http://www.gmlyo.com/categories/Docker%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Docker images 命令" scheme="http://www.gmlyo.com/tags/Docker-images-%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
</feed>
